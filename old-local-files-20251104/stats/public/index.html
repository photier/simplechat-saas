<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <!-- Layout Fix v4 - 2025-10-27 12:40 - Direct table-container margin -->
    <title data-i18n="Intergram AI Chat - Admin Panel">Intergram AI Chat - Admin Panel</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:300,400,500,600,700" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', sans-serif;
            background: #f5f8fa;
            color: #181C32;
            font-size: 13px;
            font-weight: 500;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* Sidebar */
        .sidebar {
            width: 266px;
            background: #ffffff;
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
            transition: all 0.3s ease;
            position: relative;
            z-index: 1000;
            box-shadow: 0 0 30px rgba(0,0,0,0.08);
            border-right: 1px solid #e4e6ef;
        }
        .sidebar.collapsed {
            width: 80px;
        }
        .sidebar.collapsed .menu-item span:not(.menu-item-icon) {
            display: none;
        }
        .sidebar.collapsed .sidebar-logo {
            font-size: 0;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .sidebar.collapsed .sidebar-logo-text {
            display: none;
        }
        .sidebar.collapsed .sidebar-logo img {
            margin-right: 0 !important;
            width: 40px !important;
            height: 40px !important;
        }
        .sidebar.collapsed .sidebar-logo::before {
            content: "";
            font-size: 24px;
        }
        .sidebar.collapsed .sidebar-logo svg {
            display: inline-block !important;
        }
        .sidebar-logo svg {
            width: 24px;
            height: 24px;
            stroke: currentColor;
            fill: none;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
            margin-right: 10px;
            vertical-align: middle;
        }
        .sidebar.collapsed .sidebar-logo svg {
            margin-right: 0;
        }
        .sidebar.collapsed .user-info > div {
            display: none;
        }
        .sidebar.collapsed .user-avatar {
            margin-right: 0;
        }
        .sidebar.collapsed .menu-item {
            padding: 12px 0;
            justify-content: center;
        }
        .sidebar.collapsed .logout-btn .logout-text {
            display: none;
        }
        .sidebar.collapsed .logout-btn {
            padding: 10px !important;
            font-size: 18px !important;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 50px !important;
            margin: 0 auto !important;
        }
        .sidebar.collapsed .sidebar-footer > div {
            padding: 0 !important;
            display: flex;
            justify-content: center;
        }
        .logout-btn svg {
            width: 18px;
            height: 18px;
            stroke: currentColor;
            fill: none;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
            vertical-align: middle;
            margin-right: 6px;
        }
        .sidebar.collapsed .logout-btn svg {
            margin-right: 0;
            width: 20px;
            height: 20px;
        }
        .sidebar-header {
            padding: 25px 25px;
            border-bottom: 1px solid #e4e6ef;
        }
        .sidebar-logo {
            font-size: 20px;
            font-weight: 700;
            color: #181C32;
        }
        .sidebar-menu {
            flex: 1;
            padding: 20px 0;
        }
        .menu-item {
            display: flex;
            align-items: center;
            padding: 14px 28px;
            color: #5E6278;
            text-decoration: none;
            transition: all 0.2s;
            cursor: pointer;
            font-size: 14px;
            border-left: 3px solid transparent;
            font-weight: 500;
        }
        .menu-item:hover {
            background: rgba(0,158,247,0.08);
            color: #009EF7;
        }
        .menu-item.active {
            background: rgba(0, 158, 247, 0.12);
            color: #009EF7;
            border-left-color: #009EF7;
            font-weight: 600;
        }
        .menu-item-icon {
            font-size: 18px;
            margin-right: 12px;
            width: 24px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .menu-item-icon svg {
            width: 22px;
            height: 22px;
            stroke: currentColor;
            fill: none;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }
        .sidebar-footer {
            padding: 20px 25px;
            border-top: 1px solid #e4e6ef;
        }
        .user-info {
            display: flex;
            align-items: center;
            color: #5E6278;
            font-size: 12px;
            font-weight: 500;
        }
        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            background: #009EF7;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            color: #fff;
            font-weight: 600;
        }

        /* Main Content */
        .main-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .header {
            background: #fff;
            border-bottom: 1px solid #e4e6ef;
            padding: 20px 30px;
            flex-shrink: 0;
            overflow: visible;
        }
        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0;
            height: 100%;
            overflow: visible;
        }
        .hamburger-menu {
            display: flex;
            width: 40px;
            height: 40px;
            background: #F5F8FA;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 5px;
            padding: 0;
            transition: all 0.2s;
            margin-right: 15px;
        }
        .hamburger-menu:hover {
            background: #e4e6ef;
        }
        .hamburger-menu span {
            width: 20px;
            height: 2px;
            background: #5E6278;
            border-radius: 2px;
            transition: all 0.3s;
        }
        .hamburger-menu.active span:nth-child(1) {
            transform: rotate(45deg) translate(5px, 5px);
        }
        .hamburger-menu.active span:nth-child(2) {
            opacity: 0;
        }
        .hamburger-menu.active span:nth-child(3) {
            transform: rotate(-45deg) translate(5px, -5px);
        }
        .header-title {
            font-size: 24px;
            font-weight: 700;
            color: #181C32;
            display: flex;
            align-items: center;
            line-height: 1;
        }
        .header-meta {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: auto;
            margin-right: 20px;
        }
        .header-meta-label {
            font-size: 12px;
            color: #A1A5B7;
        }
        .header-meta-value {
            font-size: 13px;
            color: #5E6278;
            font-weight: 600;
        }
        .content {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
        }

        /* Page Views */
        .page-view {
            display: none;
            min-height: calc(100vh - 100px);
        }
        .page-view.active {
            display: block;
        }

        /* Table */
        .table-container {
            background: #fff;
            border-radius: 12px;
            border: 1px solid #e4e6ef;
            overflow: hidden;
        }
        .table-header {
            padding: 20px 25px;
            border-bottom: 1px solid #eff2f5;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .table-title {
            font-size: 18px;
            font-weight: 700;
            color: #181C32;
        }
        .search-box {
            padding: 8px 16px;
            border: 1px solid #e4e6ef;
            border-radius: 6px;
            font-size: 13px;
            font-family: 'Inter', sans-serif;
            width: 250px;
        }
        .search-box:focus {
            outline: none;
            border-color: #009EF7;
        }
        .table {
            width: 100%;
            border-collapse: collapse;
        }
        .table thead {
            background: #f9f9f9;
        }
        .table th {
            padding: 15px 20px;
            text-align: left;
            font-size: 12px;
            font-weight: 600;
            color: #A1A5B7;
            text-transform: uppercase;
            border-bottom: 1px solid #eff2f5;
            cursor: pointer;
            user-select: none;
        }
        .table th:hover {
            background: #f0f0f0;
        }
        .table th.sortable::after {
            content: ' ‚áÖ';
            opacity: 0.3;
        }
        .table th.sorted-asc::after {
            content: ' ‚Üë';
            opacity: 1;
            color: #009EF7;
        }
        .table th.sorted-desc::after {
            content: ' ‚Üì';
            opacity: 1;
            color: #009EF7;
        }
        .table td {
            padding: 15px 20px;
            border-bottom: 1px solid #eff2f5;
            font-size: 13px;
            color: #5E6278;
        }
        .table tbody tr {
            cursor: pointer;
            transition: all 0.2s;
        }
        .table tbody tr:hover {
            background: #f9f9f9;
        }
        .table-user-id {
            font-weight: 600;
            color: #009EF7;
        }

        /* Badge */
        .badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 11px;
            font-weight: 600;
        }
        .badge-success { background: #E8FFF3; color: #50CD89; }
        .badge-warning { background: #FFF8DD; color: #FFC700; }
        .badge-light { background: #F5F8FA; color: #7E8299; }
        .badge-primary { background: #F1FAFF; color: #009EF7; }
        .badge-danger { background: #FFF5F8; color: #F1416C; }

        /* Messages View */
        .messages-header {
            background: #fff;
            border-radius: 12px;
            border: 1px solid #e4e6ef;
            padding: 20px 25px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .btn-back {
            padding: 10px 20px;
            background: #F5F8FA;
            color: #5E6278;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            font-family: 'Inter', sans-serif;
        }
        .btn-back:hover {
            background: #e4e6ef;
        }
        .btn-load-more {
            padding: 12px 30px;
            background: #009EF7;
            color: #fff;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            font-family: 'Inter', sans-serif;
            transition: all 0.2s;
        }
        .btn-load-more:hover {
            background: #0095e8;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 158, 247, 0.3);
        }
        .messages-container {
            background: #fff;
            border-radius: 12px;
            border: 1px solid #e4e6ef;
            padding: 25px;
            max-height: calc(100vh - 250px);
            overflow-y: auto;
        }
        .message-item {
            display: flex;
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 8px;
            background: #f9f9f9;
        }
        .message-item.user {
            background: #F1FAFF;
            border-left: 3px solid #009EF7;
        }
        .message-item.bot {
            background: #E8FFF3;
            border-left: 3px solid #50CD89;
        }
        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            margin-right: 15px;
            flex-shrink: 0;
        }
        .message-content {
            flex: 1;
        }
        .message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }
        .message-author {
            font-weight: 600;
            color: #181C32;
            font-size: 13px;
        }
        .message-time {
            font-size: 12px;
            color: #A1A5B7;
        }
        .message-text {
            color: #5E6278;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        /* Dashboard Grid */
        .row { display: flex; flex-wrap: wrap; margin: 0 -12.5px; }
        .col { padding: 0 12.5px; margin-bottom: 25px; }
        .col-3 { flex: 0 0 25%; max-width: 25%; }
        .col-4 { flex: 0 0 33.333%; max-width: 33.333%; }
        .col-6 { flex: 0 0 50%; max-width: 50%; }
        .col-8 { flex: 0 0 66.666%; max-width: 66.666%; }
        .col-12 { flex: 0 0 100%; max-width: 100%; }

        /* Force spacing for Users and Premium pages */
        #usersView > .table-container,
        #premiumView > .table-container {
            margin: 0 12.5px !important;
        }

        /* Card */
        .card {
            background: #fff;
            border-radius: 12px;
            border: 1px solid #e4e6ef;
            overflow: hidden;
            height: 100%;
        }
        .card-body { padding: 25px; }
        .card-header {
            padding: 20px 25px;
            border-bottom: 1px solid #eff2f5;
        }
        .card-title { font-size: 16px; font-weight: 700; color: #181C32; }

        /* Stat Card */
        .stat-card .stat-label {
            font-size: 13px;
            color: #A1A5B7;
            font-weight: 600;
            margin-bottom: 6px;
        }
        .stat-card .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: #181C32;
            margin-bottom: 6px;
        }
        .stat-card .stat-desc {
            font-size: 13px;
            color: #5E6278;
            font-weight: 500;
        }

        /* Hero Cards */
        .hero-card {
            border: none;
            border-radius: 24px;
            padding: 24px;
            position: relative;
            overflow: hidden;
            min-height: 140px;
            transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
        }

        .hero-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
        }

        .hero-card.card-pink {
            background: linear-gradient(135deg, #ffd6e7 0%, #ffc4d6 100%);
        }

        .hero-card.card-cyan {
            background: linear-gradient(135deg, #d4f1f4 0%, #b8e6ea 100%);
        }

        .hero-card.card-purple {
            background: linear-gradient(135deg, #e0d4f7 0%, #d1c4f0 100%);
        }

        .hero-card::after {
            content: '';
            position: absolute;
            width: 200px;
            height: 200px;
            border-radius: 50%;
            opacity: 0.15;
            top: -50px;
            right: -50px;
        }

        .hero-card.card-pink::after {
            background: white;
        }

        .hero-card.card-cyan::after {
            background: white;
        }

        .hero-card.card-purple::after {
            background: white;
        }

        .hero-label {
            font-size: 16px;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 16px;
            opacity: 0.8;
            position: relative;
            z-index: 1;
        }

        .hero-value {
            font-size: 42px;
            font-weight: 800;
            color: #1e293b;
            line-height: 1;
            margin-bottom: 6px;
            position: relative;
            z-index: 1;
        }

        .hero-desc {
            font-size: 15px;
            color: #475569;
            font-weight: 500;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .hero-icon {
            position: absolute;
            right: 28px;
            top: 28px;
            font-size: 36px;
            opacity: 0.4;
            z-index: 0;
        }

        .hero-trend {
            display: none;
        }
        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
        }
        .bg-light-primary { background: #F1FAFF; color: #009EF7; }
        .bg-light-success { background: #E8FFF3; color: #50CD89; }
        .bg-light-warning { background: #FFF8DD; color: #FFC700; }
        .bg-light-danger { background: #FFF5F8; color: #F1416C; }

        /* Chart wrapper */
        .chart-wrapper { padding: 20px 0; }
        .chart-wrapper canvas { max-height: 300px; }

        /* Country List */
        .country-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            background: #f9f9f9;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        .country-flag { font-size: 24px; margin-right: 12px; }
        .country-name { font-weight: 600; color: #181C32; font-size: 13px; }
        .country-count { font-size: 12px; color: #A1A5B7; }
        .country-percentage { font-weight: 700; color: #181C32; font-size: 13px; }

        /* Utilities */
        .d-flex { display: flex; }
        .justify-between { justify-content: space-between; }
        .align-items-center { align-items: center; }
        .text-center { text-align: center; }

        /* Modal for Conversation */
        .modal {
            display: none;
            position: fixed;
            z-index: 9999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            align-items: center;
            justify-content: center;
        }
        .modal.active { display: flex; }
        .modal-content {
            background-color: #fff;
            border-radius: 12px;
            width: 90%;
            max-width: 700px;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
        }
        .modal-header {
            padding: 20px 25px;
            border-bottom: 1px solid #eff2f5;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .modal-title {
            font-size: 18px;
            font-weight: 700;
            color: #181C32;
        }
        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #A1A5B7;
            line-height: 1;
        }
        .modal-body {
            padding: 25px;
            overflow-y: auto;
            flex: 1;
        }
        .conversation-message {
            margin-bottom: 16px;
            display: flex;
        }
        .conversation-message.visitor {
            justify-content: flex-start;
        }
        .conversation-message.admin,
        .conversation-message.live-support {
            justify-content: flex-end;
        }
        .conversation-message-content {
            max-width: 70%;
            display: flex;
            flex-direction: column;
        }
        .conversation-message.visitor .conversation-message-content {
            align-items: flex-start;
        }
        .conversation-message.admin .conversation-message-content,
        .conversation-message.live-support .conversation-message-content {
            align-items: flex-end;
        }
        .conversation-message-header {
            font-size: 13.5px;
            font-weight: 600;
            margin-bottom: 4px;
            color: #3c3c43;
            opacity: 0.8;
        }
        .conversation-message-bubble {
            padding: 12px 16px;
            border-radius: 18px;
            box-shadow: 0 1px 0.5px rgba(0,0,0,0.13);
        }
        .conversation-message.visitor .conversation-message-bubble {
            background: #f5f0f6;
            border-radius: 18px 18px 18px 4px;
            color: #000000;
        }
        .conversation-message.admin .conversation-message-bubble {
            background: rgba(0, 122, 255, 0.75);
            border-radius: 18px 18px 4px 18px;
            color: #ffffff;
        }
        .conversation-message.live-support .conversation-message-bubble {
            background: #B794F6;
            border-radius: 18px 18px 4px 18px;
            color: #ffffff;
        }
        .conversation-message-text {
            font-size: 13px;
            line-height: 1.4;
            margin-bottom: 2px;
            white-space: pre-wrap;
        }
        .conversation-message.visitor .conversation-message-text {
            color: #000000;
        }
        .conversation-message.admin .conversation-message-text,
        .conversation-message.live-support .conversation-message-text {
            color: #ffffff;
        }
        .conversation-message-time {
            font-size: 11px;
            text-align: right;
            margin-top: 6px;
            opacity: 0.6;
        }
        .conversation-message.visitor .conversation-message-time {
            color: #000000;
        }
        .conversation-message.admin .conversation-message-time,
        .conversation-message.live-support .conversation-message-time {
            color: #ffffff;
        }

        @media (max-width: 992px) {
            .col-3, .col-4, .col-6, .col-8 { flex: 0 0 100%; max-width: 100%; }
        }

        /* Settings Page */
        .settings-card {
            background: #fff;
            border-radius: 12px;
            border: 1px solid #e4e6ef;
            padding: 25px;
            margin-bottom: 25px;
        }
        .settings-section-title {
            font-size: 16px;
            font-weight: 700;
            color: #181C32;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eff2f5;
        }
        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 18px 0;
            border-bottom: 1px solid #eff2f5;
        }
        .setting-item:last-child {
            border-bottom: none;
        }
        .setting-info {
            flex: 1;
        }
        .setting-label {
            font-size: 14px;
            font-weight: 600;
            color: #181C32;
            margin-bottom: 4px;
        }
        .setting-description {
            font-size: 12px;
            color: #A1A5B7;
            line-height: 1.5;
        }

        /* Apple Style Toggle Switch */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 51px;
            height: 31px;
        }
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #e4e6ef;
            transition: 0.3s;
            border-radius: 31px;
        }
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 27px;
            width: 27px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        input:checked + .toggle-slider {
            background-color: #34C759;
        }
        input:checked + .toggle-slider:before {
            transform: translateX(20px);
        }
        input:disabled + .toggle-slider {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Settings Status Messages */
        .settings-status {
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 13px;
            margin-bottom: 20px;
            display: none;
        }
        .settings-status.success {
            background: #E8FFF3;
            color: #50CD89;
            display: block;
        }
        .settings-status.error {
            background: #FFF5F8;
            color: #F1416C;
            display: block;
        }

        /* Mobile & Tablet Responsive */
        @media (max-width: 1024px) {
            .sidebar {
                position: fixed;
                left: 0;
                top: 0;
                height: 90vh;
                z-index: 1000;
                transform: translateX(-100%);
                overflow-y: auto;
                display: flex;
                flex-direction: column;
            }

            .sidebar.mobile-open {
                transform: translateX(0);
            }

            .sidebar.collapsed {
                transform: translateX(0);
                width: 80px;
            }

            .sidebar-header {
                padding: 10px 15px !important;
                border-bottom: 1px solid #e4e6ef;
            }

            .sidebar-logo img {
                width: 28px !important;
                height: 28px !important;
                margin-right: 8px !important;
            }

            .sidebar-logo-text {
                font-size: 16px !important;
            }

            .sidebar-menu {
                padding: 10px 0 !important;
                flex: 1;
            }

            .menu-item {
                padding: 10px 20px !important;
                font-size: 14px !important;
            }

            .sidebar-footer {
                padding: 10px 15px !important;
                margin-top: auto !important;
            }

            .sidebar-footer .menu-item {
                padding: 10px 20px !important;
            }

            .main-wrapper {
                width: 100%;
            }

            .header {
                padding: 10px 20px !important;
            }

            .header-title {
                display: none !important;
            }

            .content {
                padding: 20px 15px;
            }

            .table-container {
                overflow-x: auto;
            }

            .table {
                min-width: 600px;
            }

            .card-grid {
                grid-template-columns: 1fr;
            }

            .settings-card {
                padding: 20px;
            }
        }

        @media (max-width: 768px) {
            body {
                font-size: 12px;
            }

            .header-title {
                display: none !important;
            }

            .header {
                padding: 12px 15px;
            }

            .content {
                padding: 15px 10px;
            }

            .card {
                padding: 15px;
            }

            .card-title {
                font-size: 11px;
            }

            .card-value {
                font-size: 20px;
            }

            .table {
                font-size: 11px;
            }

            .badge {
                font-size: 10px;
                padding: 3px 8px;
            }

            .btn-load-more {
                padding: 10px 20px;
                font-size: 12px;
            }
        }

        /* Overlay for mobile menu */
        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }

        .sidebar-overlay.active {
            display: block;
        }

        @media (max-width: 1024px) {
            .sidebar-overlay.active {
                display: block;
            }
        }
    
        /* Language Switcher */
        .lang-switcher {
            margin-left: 20px;
        }
        .lang-dropdown {
            position: relative;
            display: inline-block;
        }
        .lang-btn {
            background: #ffffff;
            border: 1.5px solid #e4e6ef;
            padding: 8px 14px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            font-weight: 600;
            color: #181C32;
            transition: all 0.2s ease;
        }
        .lang-btn:hover {
            border-color: #009EF7;
            background: #F1FAFF;
        }
        .lang-flag {
            font-size: 18px;
            line-height: 1;
        }
        .lang-text {
            text-transform: uppercase;
        }
        .lang-arrow {
            font-size: 10px;
            transition: transform 0.2s ease;
        }
        .lang-dropdown.active .lang-arrow {
            transform: rotate(180deg);
        }
        .lang-menu {
            position: absolute;
            top: calc(100% + 8px);
            right: 0;
            background: #ffffff;
            border: 1.5px solid #e4e6ef;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            min-width: 140px;
            display: none;
            overflow: hidden;
            z-index: 9999;
        }
        .lang-dropdown.active .lang-menu {
            display: block;
        }
        .lang-option {
            padding: 10px 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 13px;
            font-weight: 500;
            color: #181C32;
            transition: all 0.2s ease;
        }
        .lang-option:hover {
            background: #F1FAFF;
        }
        .lang-option.active {
            background: #E8F4FD;
            color: #009EF7;
            font-weight: 600;
        }

    </style>
</head>
<body>
    <!-- Sidebar Overlay (for mobile) -->
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-logo">
                <img src="/logo.png" alt="SimpleChat.Bot" style="width: 36px; height: 36px; margin-right: 10px; vertical-align: middle;"><span class="sidebar-logo-text" style="font-weight: bold; color: #1a237e; font-size: 18px;">SimpleChat.Bot</span>
            </div>
        </div>
        <div class="sidebar-menu">
            <a class="menu-item active" data-page="dashboard">
                <span class="menu-item-icon">
                    <svg viewBox="0 0 24 24">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                        <polyline points="9 22 9 12 15 12 15 22"></polyline>
                    </svg>
                </span>
                <span data-i18n="Anasayfa">Anasayfa</span>
            </a>
            <a class="menu-item" data-page="users">
                <span class="menu-item-icon">
                    <svg viewBox="0 0 24 24">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="9" cy="7" r="4"></circle>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    </svg>
                </span>
                <span data-i18n="Web Kullanƒ±cƒ±lar">Web Users</span>
            </a>
            <a class="menu-item" data-page="premium">
                <span class="menu-item-icon">
                    <svg viewBox="0 0 24 24">
                        <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                    </svg>
                </span>
                <span data-i18n="Premium Users">Premium Users</span>
            </a>
        </div>
        <div style="padding: 20px 0; border-top: 1px solid rgba(255,255,255,0.1);">
            <a class="menu-item" data-page="settings">
                <span class="menu-item-icon">
                    <svg viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path d="M12 1v6M12 17v6M4.22 4.22l4.25 4.25M15.53 15.53l4.25 4.25M1 12h6M17 12h6M4.22 19.78l4.25-4.25M15.53 8.47l4.25-4.25"></path>
                    </svg>
                </span>
                <span data-i18n="Settings">Settings</span>
            </a>
        </div>
        <div class="sidebar-footer">
            <div class="user-info">
                <div class="user-avatar">A</div>
                <div>
                    <div style="color: #3F4254; font-weight: 600; margin-bottom: 2px; font-size: 14px;">Admin</div>
                    <div style="color: #7E8299; font-size: 13px;">admin@simplechat.bot</div>
                </div>
            </div>
            <div style="margin-top: 15px; padding: 0 20px;">
                <button onclick="logout()" class="logout-btn" style="width: 100%; padding: 10px; background: rgba(241, 65, 108, 0.1); color: #F1416C; border: none; border-radius: 6px; font-size: 12px; font-weight: 600; cursor: pointer; font-family: 'Inter', sans-serif; display: flex; align-items: center; justify-content: center;">
                    <svg viewBox="0 0 24 24">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                        <polyline points="16 17 21 12 16 7"></polyline>
                        <line x1="21" y1="12" x2="9" y2="12"></line>
                    </svg>
                    <span class="logout-text" data-i18n="√áƒ±kƒ±≈ü Yap">√áƒ±kƒ±≈ü Yap</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-wrapper">
        <div class="header">
            <div class="header-content">
                <button class="hamburger-menu" id="hamburgerMenu" onclick="toggleSidebar()">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                <div class="header-title" id="pageTitle" data-i18n="Dashboard">Dashboard</div>
                <div class="header-meta">
                    <div class="header-meta-label" data-i18n="Son g√ºncelleme">Son g√ºncelleme</div>
                    <div id="lastUpdate" class="header-meta-value">-</div>
                </div>
                <div class="lang-switcher">
                    <div class="lang-dropdown" id="langDropdown">
                        <button class="lang-btn" >
                            <span class="lang-flag" id="currentFlag">üáπüá∑</span>
                            <span class="lang-text" id="currentLang">TR</span>
                            <span class="lang-arrow">‚ñº</span>
                        </button>
                        <div class="lang-menu">
                            <div class="lang-option active" data-lang="tr">
                                <span class="lang-flag">üáπüá∑</span>
                                <span>T√ºrk√ße</span>
                            </div>
                            <div class="lang-option" data-lang="en">
                                <span class="lang-flag">üá¨üáß</span>
                                <span>English</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="content">
            <!-- Dashboard View -->
            <div id="dashboardView" class="page-view active">
                <!-- Hero Stats -->
                <div class="row" style="margin-bottom: 16px;">
                    <div class="col col-4">
                        <div class="card hero-card card-pink">
                            <div class="hero-icon">üü¢</div>
                            <div class="hero-label" data-i18n="Online Now">√áevrimi√ßi</div>
                            <div id="heroOnline" class="hero-value">-</div>
                            <div class="hero-desc" data-i18n="active users">aktif kullanƒ±cƒ±</div>
                        </div>
                    </div>
                    <div class="col col-4">
                        <div class="card hero-card card-cyan">
                            <div class="hero-icon">üëÅÔ∏è</div>
                            <div class="hero-label" data-i18n="Total Impressions">Toplam Tƒ±klama</div>
                            <div id="heroTotalImpressions" class="hero-value">-</div>
                            <div class="hero-desc" data-i18n="all openers">t√ºm a√ßanlar</div>
                        </div>
                    </div>
                    <div class="col col-4">
                        <div class="card hero-card card-purple">
                            <div class="hero-icon">üìà</div>
                            <div class="hero-label" data-i18n="Conversion Rate">Konversiyon Oranƒ±</div>
                            <div id="heroConversionRate" class="hero-value">-</div>
                            <div class="hero-desc" data-i18n="openers / talkers">a√ßan / konu≈üan</div>
                        </div>
                    </div>
                </div>

                <!-- Summary Stats -->
                <div class="row">
                    <div class="col col-3">
                        <div class="card stat-card">
                            <div class="card-body d-flex justify-between align-items-center">
                                <div>
                                    <div class="stat-label" data-i18n="Toplam Session">Toplam Session</div>
                                    <div id="totalUsers" class="stat-value">-</div>
                                    <div id="usersOnline" class="stat-desc">- <span data-i18n="online">online</span></div>
                                </div>
                                <div class="stat-icon bg-light-primary">üë•</div>
                            </div>
                        </div>
                    </div>
                    <div class="col col-3">
                        <div class="card stat-card">
                            <div class="card-body d-flex justify-between align-items-center">
                                <div>
                                    <div class="stat-label" data-i18n="Toplam Kullanƒ±cƒ±">Toplam Kullanƒ±cƒ±</div>
                                    <div id="aiHandled" class="stat-value">-</div>
                                    <div class="stat-desc" data-i18n="benzersiz ziyaret√ßi">benzersiz ziyaret√ßi</div>
                                </div>
                                <div class="stat-icon bg-light-success">üë•</div>
                            </div>
                        </div>
                    </div>
                    <div class="col col-3">
                        <div class="card stat-card">
                            <div class="card-body d-flex justify-between align-items-center">
                                <div>
                                    <div class="stat-label" data-i18n="Bug√ºn Aktif">Bug√ºn Aktif</div>
                                    <div id="humanHandled" class="stat-value">-</div>
                                    <div class="stat-desc" data-i18n="bug√ºnk√º kullanƒ±cƒ±">bug√ºnk√º kullanƒ±cƒ±</div>
                                </div>
                                <div class="stat-icon bg-light-warning">‚ö°</div>
                            </div>
                        </div>
                    </div>
                    <div class="col col-3">
                        <div class="card stat-card">
                            <div class="card-body d-flex justify-between align-items-center">
                                <div>
                                    <div class="stat-label" data-i18n="Total Messages">Total Messages</div>
                                    <div id="totalMessages" class="stat-value">-</div>
                                    <div id="avgResponseTime" class="stat-desc"><span data-i18n="Ort. yanƒ±t">Avg. response</span>: -</div>
                                </div>
                                <div class="stat-icon bg-light-danger">üí¨</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Session Duration Row -->
                <div class="row">
                    <div class="col col-4">
                        <div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; color: white;">
                            <div class="card-body" style="padding: 25px;">
                                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px;">
                                    <div>
                                        <div style="font-size: 12px; opacity: 0.85; font-weight: 500; margin-bottom: 4px;" data-i18n="ORTALAMA S√úRE">‚è±Ô∏è ORTALAMA S√úRE</div>
                                        <h3 style="font-size: 18px; font-weight: 600; margin: 0; color: white;" data-i18n="Oturum S√ºresi">Oturum S√ºresi</h3>
                                    </div>
                                    <div style="font-size: 32px;">‚è≥</div>
                                </div>
                                <div style="display: flex; align-items: baseline; gap: 8px; margin-bottom: 15px;">
                                    <div id="avgSessionDuration" style="font-size: 42px; font-weight: 800; color: white; line-height: 1;">5.2</div>
                                    <div style="font-size: 18px; opacity: 0.8; font-weight: 600;">dakika</div>
                                </div>
                                <div style="padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.2); display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                                    <div>
                                        <div style="font-size: 11px; opacity: 0.7; margin-bottom: 4px;" data-i18n="En Kƒ±sa">En Kƒ±sa</div>
                                        <div id="minSessionDuration" style="font-size: 16px; font-weight: 600;">1.2 dk</div>
                                    </div>
                                    <div>
                                        <div style="font-size: 11px; opacity: 0.7; margin-bottom: 4px;" data-i18n="Longest">En Uzun</div>
                                        <div id="maxSessionDuration" style="font-size: 16px; font-weight: 600;">15.3 dk</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col col-4">
                        <div class="card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border: none; color: white;">
                            <div class="card-body" style="padding: 25px;">
                                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px;">
                                    <div>
                                        <div style="font-size: 12px; opacity: 0.85; font-weight: 500; margin-bottom: 4px;" data-i18n="ORT. MESAJ">üí¨ ORT. MESAJ</div>
                                        <h3 style="font-size: 18px; font-weight: 600; margin: 0; color: white;" data-i18n="Mesaj / Session">Mesaj / Session</h3>
                                    </div>
                                    <div style="font-size: 32px;">üìä</div>
                                </div>
                                <div style="display: flex; align-items: baseline; gap: 8px; margin-bottom: 15px;">
                                    <div id="avgMessagesPerSession" style="font-size: 42px; font-weight: 800; color: white; line-height: 1;">8.3</div>
                                    <div style="font-size: 18px; opacity: 0.8; font-weight: 600;">mesaj</div>
                                </div>
                                <div style="padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.2);">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <div style="font-size: 12px; opacity: 0.8;" data-i18n="Total Sessions">Toplam Session</div>
                                        <div id="totalSessions" style="font-size: 18px; font-weight: 700;">194</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col col-4">
                        <div class="card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); border: none; color: white;">
                            <div class="card-body" style="padding: 25px;">
                                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px;">
                                    <div>
                                        <div style="font-size: 12px; opacity: 0.85; font-weight: 500; margin-bottom: 4px;" data-i18n="KANAL DAƒûILIMI">üåç KANAL DAƒûILIMI</div>
                                        <h3 style="font-size: 18px; font-weight: 600; margin: 0; color: white;" data-i18n="AI / Human">AI / Human</h3>
                                    </div>
                                    <div style="font-size: 32px;">üì°</div>
                                </div>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;">
                                    <div style="background: rgba(255,255,255,0.15); padding: 15px; border-radius: 12px; backdrop-filter: blur(10px);">
                                        <div style="font-size: 11px; opacity: 0.85; margin-bottom: 6px;" data-i18n="AI ile Hizmet">ü§ñ AI ile Hizmet</div>
                                        <div id="webSessionCount" style="font-size: 28px; font-weight: 800; line-height: 1;">181</div>
                                        <div id="webSessionPercentage" style="font-size: 11px; opacity: 0.8; margin-top: 4px;">93%</div>
                                    </div>
                                    <div style="background: rgba(255,255,255,0.15); padding: 15px; border-radius: 12px; backdrop-filter: blur(10px);">
                                        <div style="font-size: 11px; opacity: 0.85; margin-bottom: 6px;" data-i18n="Destek Ekibi">üë§ Destek Ekibi</div>
                                        <div id="premiumSessionCount" style="font-size: 28px; font-weight: 800; line-height: 1;">13</div>
                                        <div id="premiumSessionPercentage" style="font-size: 11px; opacity: 0.8; margin-top: 4px;">7%</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Busiest Hours Heatmap -->
                <div class="row">
                    <div class="col col-12">
                        <div class="card">
                            <div class="card-body" style="padding: 30px;">
                                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 24px;">
                                    <div>
                                        <div style="font-size: 14px; opacity: 0.6; font-weight: 500; margin-bottom: 6px;" data-i18n="TRAFƒ∞K ANALƒ∞Zƒ∞">üìä TRAFƒ∞K ANALƒ∞Zƒ∞</div>
                                        <h2 style="font-size: 28px; font-weight: 700; margin: 0; color: #1e1e2d;" data-i18n="En Yoƒüun Saatler Haritasƒ±">En Yoƒüun Saatler Haritasƒ±</h2>
                                        <p style="font-size: 14px; opacity: 0.7; margin-top: 6px;" data-i18n="Hangi g√ºn ve saatlerde en √ßok mesaj alƒ±nƒ±yor?">Hangi g√ºn ve saatlerde en √ßok mesaj alƒ±nƒ±yor? (Web + Premium)</p>
                                    </div>
                                    <div style="font-size: 48px;">üî•</div>
                                </div>

                                <!-- Heatmap Grid -->
                                <div style="overflow-x: auto;">
                                    <div style="min-width: 900px;">
                                        <!-- Hour Labels -->
                                        <div style="display: grid; grid-template-columns: 80px repeat(24, 1fr); gap: 2px; margin-bottom: 2px;">
                                            <div style="font-size: 11px; font-weight: 600; color: #A1A5B7; text-align: center;"></div>
                                            <div style="font-size: 10px; font-weight: 600; color: #A1A5B7; text-align: center;">00</div>
                                            <div style="font-size: 10px; font-weight: 600; color: #A1A5B7; text-align: center;">01</div>
                                            <div style="font-size: 10px; font-weight: 600; color: #A1A5B7; text-align: center;">02</div>
                                            <div style="font-size: 10px; font-weight: 600; color: #A1A5B7; text-align: center;">03</div>
                                            <div style="font-size: 10px; font-weight: 600; color: #A1A5B7; text-align: center;">04</div>
                                            <div style="font-size: 10px; font-weight: 600; color: #A1A5B7; text-align: center;">05</div>
                                            <div style="font-size: 10px; font-weight: 600; color: #A1A5B7; text-align: center;">06</div>
                                            <div style="font-size: 10px; font-weight: 600; color: #A1A5B7; text-align: center;">07</div>
                                            <div style="font-size: 10px; font-weight: 600; color: #A1A5B7; text-align: center;">08</div>
                                            <div style="font-size: 10px; font-weight: 600; color: #A1A5B7; text-align: center;">09</div>
                                            <div style="font-size: 10px; font-weight: 600; color: #A1A5B7; text-align: center;">10</div>
                                            <div style="font-size: 10px; font-weight: 600; color: #A1A5B7; text-align: center;">11</div>
                                            <div style="font-size: 10px; font-weight: 600; color: #A1A5B7; text-align: center;">12</div>
                                            <div style="font-size: 10px; font-weight: 600; color: #A1A5B7; text-align: center;">13</div>
                                            <div style="font-size: 10px; font-weight: 600; color: #A1A5B7; text-align: center;">14</div>
                                            <div style="font-size: 10px; font-weight: 600; color: #A1A5B7; text-align: center;">15</div>
                                            <div style="font-size: 10px; font-weight: 600; color: #A1A5B7; text-align: center;">16</div>
                                            <div style="font-size: 10px; font-weight: 600; color: #A1A5B7; text-align: center;">17</div>
                                            <div style="font-size: 10px; font-weight: 600; color: #A1A5B7; text-align: center;">18</div>
                                            <div style="font-size: 10px; font-weight: 600; color: #A1A5B7; text-align: center;">19</div>
                                            <div style="font-size: 10px; font-weight: 600; color: #A1A5B7; text-align: center;">20</div>
                                            <div style="font-size: 10px; font-weight: 600; color: #A1A5B7; text-align: center;">21</div>
                                            <div style="font-size: 10px; font-weight: 600; color: #A1A5B7; text-align: center;">22</div>
                                            <div style="font-size: 10px; font-weight: 600; color: #A1A5B7; text-align: center;">23</div>
                                        </div>

                                        <!-- Heatmap Rows (7 days) -->
                                        <div id="heatmapContainer"></div>

                                        <!-- Legend -->
                                        <div style="display: flex; align-items: center; justify-content: center; gap: 12px; margin-top: 20px; padding-top: 20px; border-top: 1px solid #f1f1f4;">
                                            <span style="font-size: 12px; font-weight: 600; color: #A1A5B7;">Az</span>
                                            <div style="display: flex; gap: 3px;">
                                                <div style="width: 20px; height: 20px; background: #E8F4FD; border-radius: 4px;"></div>
                                                <div style="width: 20px; height: 20px; background: #B3D9F2; border-radius: 4px;"></div>
                                                <div style="width: 20px; height: 20px; background: #7DB8E8; border-radius: 4px;"></div>
                                                <div style="width: 20px; height: 20px; background: #4897DD; border-radius: 4px;"></div>
                                                <div style="width: 20px; height: 20px; background: #2C7AB5; border-radius: 4px;"></div>
                                                <div style="width: 20px; height: 20px; background: #1A5C8C; border-radius: 4px;"></div>
                                                <div style="width: 20px; height: 20px; background: #0D3E63; border-radius: 4px;"></div>
                                            </div>
                                            <span style="font-size: 12px; font-weight: 600; color: #A1A5B7;">High</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- AI Success Rate -->
                <div class="row">
                    <div class="col col-12">
                        <div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; color: white;">
                            <div class="card-body" style="padding: 30px;">
                                <div style="display: flex; align-items: center; justify-content: space-between;">
                                    <div style="flex: 1;">
                                        <div style="font-size: 14px; opacity: 0.9; font-weight: 500; margin-bottom: 6px;" data-i18n="AI PERFORMANS">üéØ AI PERFORMANS</div>
                                        <h2 style="font-size: 32px; font-weight: 700; margin: 0 0 12px 0; color: white;" data-i18n="AI Ba≈üarƒ± Oranƒ±">AI Ba≈üarƒ± Oranƒ±</h2>
                                        <p style="font-size: 14px; opacity: 0.85; margin: 0; max-width: 500px; line-height: 1.6;" data-i18n="AI desteƒüi olmadan √ß√∂z√ºlen konu≈üma y√ºzdesi">
                                            ƒ∞nsan desteƒüine ihtiya√ß duymadan AI tarafƒ±ndan ba≈üarƒ±yla √ß√∂z√ºlen konu≈ümalarƒ±n y√ºzdesi. Y√ºksek oran, AI'ƒ±n kullanƒ±cƒ± sorularƒ±nƒ± etkili bir ≈üekilde yanƒ±tladƒ±ƒüƒ±nƒ± g√∂sterir.
                                        </p>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 40px;">
                                        <div style="text-align: center;">
                                            <div style="position: relative; width: 160px; height: 160px;">
                                                <svg width="160" height="160" style="transform: rotate(-90deg);">
                                                    <!-- Background circle -->
                                                    <circle cx="80" cy="80" r="70" fill="none" stroke="rgba(255,255,255,0.2)" stroke-width="12"></circle>
                                                    <!-- Progress circle -->
                                                    <circle id="aiSuccessCircle" cx="80" cy="80" r="70" fill="none" stroke="#50CD89" stroke-width="12"
                                                            stroke-linecap="round" stroke-dasharray="440" stroke-dashoffset="440"
                                                            style="transition: stroke-dashoffset 1s ease;">
                                                    </circle>
                                                </svg>
                                                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center;">
                                                    <div id="aiSuccessRate" style="font-size: 42px; font-weight: 800; color: white; line-height: 1;">79%</div>
                                                    <div style="font-size: 11px; opacity: 0.8; margin-top: 4px; font-weight: 600;">SUCCESS</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div style="display: flex; flex-direction: column; gap: 16px;">
                                            <div style="display: flex; align-items: center; gap: 12px;">
                                                <div style="width: 12px; height: 12px; background: #50CD89; border-radius: 3px;"></div>
                                                <div>
                                                    <div style="font-size: 13px; opacity: 0.8;" data-i18n="AI Ba≈üarƒ±">AI Ba≈üarƒ±</div>
                                                    <div id="aiSuccessCount" style="font-size: 22px; font-weight: 700;">153</div>
                                                </div>
                                            </div>
                                            <div style="display: flex; align-items: center; gap: 12px;">
                                                <div style="width: 12px; height: 12px; background: #FFC700; border-radius: 3px;"></div>
                                                <div>
                                                    <div style="font-size: 13px; opacity: 0.8;" data-i18n="Human Support">Human Support</div>
                                                    <div id="humanEscalationCount" style="font-size: 22px; font-weight: 700;">41</div>
                                                </div>
                                            </div>
                                            <div style="padding-top: 8px; border-top: 1px solid rgba(255,255,255,0.2);">
                                                <div style="font-size: 11px; opacity: 0.7;" data-i18n="TOTAL CONVERSATIONS">TOTAL CONVERSATIONS</div>
                                                <div id="totalConversations" style="font-size: 18px; font-weight: 600; margin-top: 4px;">194</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Charts -->
                <div class="row">
                    <div class="col col-6">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title" data-i18n="Daily User Count">Daily User Count</h3>
                            </div>
                            <div class="card-body">
                                <div class="chart-wrapper">
                                    <canvas id="dailyUsersChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col col-6">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title" data-i18n="AI vs Human Support">AI vs Human Support</h3>
                            </div>
                            <div class="card-body">
                                <div style="height: 350px; position: relative;">
                                    <canvas id="aiVsHumanChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Messages & Countries -->
                <div class="row">
                    <div class="col col-8">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title" data-i18n="Message Distribution (Monthly)">Message Distribution (Monthly)</h3>
                            </div>
                            <div class="card-body">
                                <div class="chart-wrapper">
                                    <canvas id="messagesChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col col-4">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title" data-i18n="Country Distribution">Country Distribution</h3>
                            </div>
                            <div class="card-body">
                                <div id="countryList"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Users View -->
            <div id="usersView" class="page-view">
                <div class="table-container">
                    <div class="table-header">
                        <div class="table-title" data-i18n="Web Users">Web Users</div>
                        <input type="text" class="search-box" id="usersSearch" placeholder="Search user..." data-i18n-placeholder="Search user...">
                    </div>
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th class="sortable" data-sort="userId" data-i18n="User ID">User ID</th>
                                        <th class="sortable" data-sort="userName" data-i18n="Name">Name</th>
                                        <th class="sortable" data-sort="messageCount" data-i18n="Message Count">Message Count</th>
                                        <th class="sortable" data-sort="lastActivity" data-i18n="Last Activity">Last Activity</th>
                                        <th data-sort="country" data-i18n="Country">Country</th>
                                        <th data-i18n="Support Type">Support Type</th>
                                        <th data-i18n="Status">Status</th>
                                    </tr>
                                </thead>
                                <tbody id="usersTableBody">
                                    <tr>
                                        <td colspan="7" class="text-center" style="padding: 40px; color: #A1A5B7;">Y√ºkleniyor...</td>
                                    </tr>
                                </tbody>
                    </table>
                    <div id="usersPagination" style="display: none;"></div>
                </div>
            </div>

            <!-- User Messages View -->
            <div id="userMessagesView" class="page-view">
                <div class="messages-header">
                    <div>
                        <div style="font-size: 18px; font-weight: 700; color: #181C32; margin-bottom: 5px;" id="userMessagesTitle">Kullanƒ±cƒ± Mesajlarƒ±</div>
                        <div style="font-size: 13px; color: #A1A5B7;" id="userMessagesSubtitle">-</div>
                    </div>
                    <button class="btn-back" onclick="navigateToPage('users')"><span data-i18n="Back to Web Users">‚Üê Back to Web Users</span></button>
                </div>
                <div class="messages-container" id="messagesContainer">
                    <div class="text-center" style="padding: 40px; color: #A1A5B7;">Mesajlar y√ºkleniyor...</div>
                </div>
            </div>

            <!-- Premium Chat View -->
            <div id="premiumView" class="page-view">
                <div class="table-container">
                    <div class="table-header">
                        <div class="table-title" data-i18n="Premium Users">Premium Users</div>
                        <input type="text" class="search-box" id="premiumSearch" placeholder="Search user..." data-i18n-placeholder="Search user...">
                    </div>
                    <table class="table">
                                <thead>
                                    <tr>
                                        <th data-i18n="User ID">User ID</th>
                                        <th data-i18n="Name">Name</th>
                                        <th data-i18n="Message Count">Message Count</th>
                                        <th data-i18n="Last Activity">Last Activity</th>
                                        <th data-i18n="Country">Country</th>
                                        <th data-i18n="Support Type">Support Type</th>
                                        <th data-i18n="Status">Status</th>
                                    </tr>
                                </thead>
                                <tbody id="premiumTableBody">
                                    <tr>
                                        <td colspan="7" class="text-center" style="padding: 40px; color: #A1A5B7;">Y√ºkleniyor...</td>
                                    </tr>
                                </tbody>
                    </table>
                    <div id="premiumPagination" style="display: none;"></div>
                </div>
            </div>

            <!-- Settings View -->
            <div id="settingsView" class="page-view">
                <div id="settingsStatusMessage" class="settings-status"></div>

                <!-- Web Chat Settings -->
                <div class="settings-card">
                    <div class="settings-section-title">
                        <span style="font-size: 20px; margin-right: 8px;">üí¨</span>
                        <span data-i18n="Web Chat Settings">Web Chat Settings</span> (chat.simplechat.bot)
                    </div>

                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-label">Widget Ana Rengi</div>
                            <div class="setting-description">
                                Primary color for chat widget (used for header, buttons, highlights)
                            </div>
                        </div>
                        <div style="position: relative; display: flex; align-items: center; background: #f5f5f7; border-radius: 10px; padding: 6px 12px; border: 1.5px solid #d1d1d6; width: fit-content;">
                            <input type="color" id="webThemeColor" value="#009EF7" onchange="updateWebColorPreview()" style="width: 32px; height: 32px; border: none; border-radius: 6px; cursor: pointer; background: transparent;">
                            <div style="width: 1px; height: 24px; background: #d1d1d6; margin: 0 10px;"></div>
                            <input type="text" id="webThemeHex" value="#009EF7" oninput="updateWebColorFromHex()" maxlength="7" style="width: 80px; border: none; background: transparent; font-family: 'SF Mono', 'Monaco', 'Courier New', monospace; font-size: 13px; font-weight: 500; color: #1d1d1f; outline: none;" placeholder="#000000">
                        </div>
                    </div>

                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-label" data-i18n="Chat Ba≈ülƒ±ƒüƒ± (Kapalƒ±)">Chat Ba≈ülƒ±ƒüƒ± (Kapalƒ±)</div>
                            <div class="setting-description">
                                <span data-i18n="Widget kapalƒ±yken g√∂sterilen ba≈ülƒ±k metni">Widget kapalƒ±yken g√∂sterilen ba≈ülƒ±k metni</span> (can be left empty)
                            </div>
                        </div>
                        <input type="text" id="webTitleClosed" placeholder="e.g: Support" maxlength="50" style="padding: 8px 12px; border: 1.5px solid #d1d1d6; border-radius: 8px; font-size: 13px; min-width: 250px; font-family: '-apple-system', BlinkMacSystemFont, 'Segoe UI', sans-serif;">
                    </div>

                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-label" data-i18n="Chat Ba≈ülƒ±ƒüƒ± (A√ßƒ±k)">Chat Ba≈ülƒ±ƒüƒ± (A√ßƒ±k)</div>
                            <div class="setting-description">
                                <span data-i18n="Widget a√ßƒ±kken g√∂sterilen ba≈ülƒ±k metni">Widget a√ßƒ±kken g√∂sterilen ba≈ülƒ±k metni</span>
                            </div>
                        </div>
                        <input type="text" id="webTitleOpen" placeholder="e.g: ü§ñ Photier AI Bot" maxlength="50" style="padding: 8px 12px; border: 1.5px solid #d1d1d6; border-radius: 8px; font-size: 13px; min-width: 250px; font-family: '-apple-system', BlinkMacSystemFont, 'Segoe UI', sans-serif;">
                    </div>

                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-label" data-i18n="Kar≈üƒ±lama Mesajƒ±">Kar≈üƒ±lama Mesajƒ±</div>
                            <div class="setting-description">
                                <span data-i18n="Chat a√ßƒ±ldƒ±ƒüƒ±nda kullanƒ±cƒ±ya g√∂sterilen ilk mesaj">Chat a√ßƒ±ldƒ±ƒüƒ±nda kullanƒ±cƒ±ya g√∂sterilen ilk mesaj</span>
                            </div>
                        </div>
                        <textarea id="webIntroMessage" placeholder="e.g: Hello, How can I help you today? ‚ú®" rows="2" maxlength="200" style="padding: 8px 12px; border: 1.5px solid #d1d1d6; border-radius: 8px; font-size: 13px; min-width: 250px; resize: vertical; font-family: '-apple-system', BlinkMacSystemFont, 'Segoe UI', sans-serif;"></textarea>
                    </div>

                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-label" data-i18n="√áalƒ±≈üma Saatleri">√áalƒ±≈üma Saatleri</div>
                            <div class="setting-description">
                                <span data-i18n="√áalƒ±≈üma saatleri dƒ±≈üƒ±nda widget\'ƒ± otomatik olarak gizle">√áalƒ±≈üma saatleri dƒ±≈üƒ±nda widget\'ƒ± otomatik olarak gizle</span>
                            </div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="webWorkingHoursEnabled">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>

                    <div class="setting-item" id="webWorkingHoursTimeContainer" style="display: none;">
                        <div class="setting-info">
                            <div class="setting-label">Working Hours (Turkey Time)</div>
                            <div class="setting-description">
                                Set start and end times
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="time" id="webWorkingHoursStart" style="padding: 8px 12px; border: 1.5px solid #d1d1d6; border-radius: 8px; font-size: 13px; font-family: '-apple-system', BlinkMacSystemFont, 'Segoe UI', sans-serif;">
                            <span style="color: #86868b; font-weight: 500;">-</span>
                            <input type="time" id="webWorkingHoursEnd" style="padding: 8px 12px; border: 1.5px solid #d1d1d6; border-radius: 8px; font-size: 13px; font-family: '-apple-system', BlinkMacSystemFont, 'Segoe UI', sans-serif;">
                        </div>
                    </div>

                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-label" data-i18n="Servis Mesajlarƒ±">Servis Mesajlarƒ±</div>
                            <div class="setting-description">
                                User connection notifications ("connected to chat", "has come back", "has left") and sending user messages to Telegram
                            </div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="webServiceMessages">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>

                    <!-- Widget Tema Se√ßimi -->
                    <div class="setting-item" style="border-top: 2px solid #f1f1f4; padding-top: 20px; margin-top: 20px;">
                        <div class="setting-info">
                            <div class="setting-label" data-i18n="Widget Temasƒ±">Widget Temasƒ±</div>
                            <div class="setting-description">
                                <span data-i18n="Widget tasarƒ±mƒ±nƒ± se√ßin">Widget tasarƒ±mƒ±nƒ± se√ßin</span>
                            </div>
                        </div>
                        <select id="webThemeSelect" onchange="selectWebTheme(this.value)" style="padding: 8px 12px; border: 1.5px solid #d1d1d6; border-radius: 8px; font-size: 13px; min-width: 200px; font-family: '-apple-system', BlinkMacSystemFont, 'Segoe UI', sans-serif; background: white; cursor: pointer;">
                            <option value="bubble-chat" data-i18n-option="Bubble Chat">Bubble Chat</option>
                            <option value="coming-soon" disabled data-i18n-option="Yakƒ±nda...">Yakƒ±nda...</option>
                        </select>
                    </div>

                    <!-- Web Chat Tek Kaydet Butonu -->
                    <div class="setting-item" style="margin-top: 20px; padding-top: 20px; border-top: 2px solid #f1f1f4;">
                        <div style="display: flex; justify-content: flex-end; width: 100%;">
                            <button onclick="saveAllWebSettings()" style="padding: 10px 24px; background: #007aff; color: #fff; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; font-family: '-apple-system', BlinkMacSystemFont, 'Segoe UI', sans-serif; transition: all 0.2s ease;" onmouseenter="this.style.background='#0051d5'" onmouseleave="this.style.background='#007aff'">
                                T√ºm Ayarlarƒ± Kaydet
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Premium Chat Settings -->
                <div class="settings-card">
                    <div class="settings-section-title">
                        <span style="font-size: 20px; margin-right: 8px;">‚≠ê</span>
                        <span data-i18n="Premium Chat Settings">Premium Chat Settings</span> (p-chat.simplechat.bot)
                    </div>

                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-label">Widget Ana Rengi</div>
                            <div class="setting-description">
                                Primary color for chat widget (used for header, buttons, highlights)
                            </div>
                        </div>
                        <div style="position: relative; display: flex; align-items: center; background: #f5f5f7; border-radius: 10px; padding: 6px 12px; border: 1.5px solid #d1d1d6; width: fit-content;">
                            <input type="color" id="premiumThemeColor" value="#9F7AEA" onchange="updatePremiumColorPreview()" style="width: 32px; height: 32px; border: none; border-radius: 6px; cursor: pointer; background: transparent;">
                            <div style="width: 1px; height: 24px; background: #d1d1d6; margin: 0 10px;"></div>
                            <input type="text" id="premiumThemeHex" value="#9F7AEA" oninput="updatePremiumColorFromHex()" maxlength="7" style="width: 80px; border: none; background: transparent; font-family: 'SF Mono', 'Monaco', 'Courier New', monospace; font-size: 13px; font-weight: 500; color: #1d1d1f; outline: none;" placeholder="#000000">
                        </div>
                    </div>

                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-label" data-i18n="Chat Ba≈ülƒ±ƒüƒ± (Kapalƒ±)">Chat Ba≈ülƒ±ƒüƒ± (Kapalƒ±)</div>
                            <div class="setting-description">
                                <span data-i18n="Widget kapalƒ±yken g√∂sterilen ba≈ülƒ±k metni">Widget kapalƒ±yken g√∂sterilen ba≈ülƒ±k metni</span> (can be left empty)
                            </div>
                        </div>
                        <input type="text" id="premiumTitleClosed" placeholder="e.g: Premium Support" maxlength="50" style="padding: 8px 12px; border: 1.5px solid #d1d1d6; border-radius: 8px; font-size: 13px; min-width: 250px; font-family: '-apple-system', BlinkMacSystemFont, 'Segoe UI', sans-serif;">
                    </div>

                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-label" data-i18n="Chat Ba≈ülƒ±ƒüƒ± (A√ßƒ±k)">Chat Ba≈ülƒ±ƒüƒ± (A√ßƒ±k)</div>
                            <div class="setting-description">
                                <span data-i18n="Widget a√ßƒ±kken g√∂sterilen ba≈ülƒ±k metni">Widget a√ßƒ±kken g√∂sterilen ba≈ülƒ±k metni</span>
                            </div>
                        </div>
                        <input type="text" id="premiumTitleOpen" placeholder="e.g: üë§ Destek Ekibi Support" maxlength="50" style="padding: 8px 12px; border: 1.5px solid #d1d1d6; border-radius: 8px; font-size: 13px; min-width: 250px; font-family: '-apple-system', BlinkMacSystemFont, 'Segoe UI', sans-serif;">
                    </div>

                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-label" data-i18n="Kar≈üƒ±lama Mesajƒ±">Kar≈üƒ±lama Mesajƒ±</div>
                            <div class="setting-description">
                                <span data-i18n="Chat a√ßƒ±ldƒ±ƒüƒ±nda kullanƒ±cƒ±ya g√∂sterilen ilk mesaj">Chat a√ßƒ±ldƒ±ƒüƒ±nda kullanƒ±cƒ±ya g√∂sterilen ilk mesaj</span>
                            </div>
                        </div>
                        <textarea id="premiumIntroMessage" placeholder="e.g: Welcome to Premium Support! How can I assist you? ‚ú®" rows="2" maxlength="200" style="padding: 8px 12px; border: 1.5px solid #d1d1d6; border-radius: 8px; font-size: 13px; min-width: 250px; resize: vertical; font-family: '-apple-system', BlinkMacSystemFont, 'Segoe UI', sans-serif;"></textarea>
                    </div>

                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-label" data-i18n="AI Bot Kar≈üƒ±lama Mesajƒ±">AI Bot Kar≈üƒ±lama Mesajƒ±</div>
                            <div class="setting-description">
                                <span data-i18n="AI Bot tab\'ƒ±nda kullanƒ±cƒ±ya g√∂sterilen ilk mesaj">AI Bot tab\'ƒ±nda kullanƒ±cƒ±ya g√∂sterilen ilk mesaj</span>
                            </div>
                        </div>
                        <textarea id="premiumAiIntroMessage" placeholder="e.g: Hi there! üëã I'm Photier AI, your 24/7 virtual assistant. How can I help you today?" rows="2" maxlength="200" style="padding: 8px 12px; border: 1.5px solid #d1d1d6; border-radius: 8px; font-size: 13px; min-width: 250px; resize: vertical; font-family: '-apple-system', BlinkMacSystemFont, 'Segoe UI', sans-serif;"></textarea>
                    </div>

                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-label" data-i18n="√áalƒ±≈üma Saatleri">√áalƒ±≈üma Saatleri</div>
                            <div class="setting-description">
                                <span data-i18n="√áalƒ±≈üma saatleri dƒ±≈üƒ±nda widget\'ƒ± otomatik olarak gizle">√áalƒ±≈üma saatleri dƒ±≈üƒ±nda widget\'ƒ± otomatik olarak gizle</span>
                            </div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="premiumWorkingHoursEnabled">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>

                    <div class="setting-item" id="premiumWorkingHoursTimeContainer" style="display: none;">
                        <div class="setting-info">
                            <div class="setting-label">Working Hours (Turkey Time)</div>
                            <div class="setting-description">
                                Set start and end times
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="time" id="premiumWorkingHoursStart" style="padding: 8px 12px; border: 1.5px solid #d1d1d6; border-radius: 8px; font-size: 13px; font-family: '-apple-system', BlinkMacSystemFont, 'Segoe UI', sans-serif;">
                            <span style="color: #86868b; font-weight: 500;">-</span>
                            <input type="time" id="premiumWorkingHoursEnd" style="padding: 8px 12px; border: 1.5px solid #d1d1d6; border-radius: 8px; font-size: 13px; font-family: '-apple-system', BlinkMacSystemFont, 'Segoe UI', sans-serif;">
                        </div>
                    </div>

                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-label" data-i18n="Servis Mesajlarƒ±">Servis Mesajlarƒ±</div>
                            <div class="setting-description">
                                User connection notifications ("connected to chat", "has come back", "has left") and sending user messages to Telegram
                            </div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="premiumServiceMessages">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>

                    <!-- Widget Tema Se√ßimi -->
                    <div class="setting-item" style="border-top: 2px solid #f1f1f4; padding-top: 20px; margin-top: 20px;">
                        <div class="setting-info">
                            <div class="setting-label" data-i18n="Widget Temasƒ±">Widget Temasƒ±</div>
                            <div class="setting-description">
                                <span data-i18n="Widget tasarƒ±mƒ±nƒ± se√ßin">Widget tasarƒ±mƒ±nƒ± se√ßin</span>
                            </div>
                        </div>
                        <select id="premiumThemeSelect" onchange="selectPremiumTheme(this.value)" style="padding: 8px 12px; border: 1.5px solid #d1d1d6; border-radius: 8px; font-size: 13px; min-width: 200px; font-family: '-apple-system', BlinkMacSystemFont, 'Segoe UI', sans-serif; background: white; cursor: pointer;">
                            <option value="bubble-chat" data-i18n-option="Bubble Chat">Bubble Chat</option>
                            <option value="coming-soon" disabled data-i18n-option="Yakƒ±nda...">Yakƒ±nda...</option>
                        </select>
                    </div>

                    <!-- Premium Chat Tek Kaydet Butonu -->
                    <div class="setting-item" style="margin-top: 20px; padding-top: 20px; border-top: 2px solid #f1f1f4;">
                        <div style="display: flex; justify-content: flex-end; width: 100%;">
                            <button onclick="saveAllPremiumSettings()" style="padding: 10px 24px; background: #9F7AEA; color: #fff; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; font-family: '-apple-system', BlinkMacSystemFont, 'Segoe UI', sans-serif; transition: all 0.2s ease;" onmouseenter="this.style.background='#7c3aed'" onmouseleave="this.style.background='#9F7AEA'">
                                T√ºm Ayarlarƒ± Kaydet
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Info Card -->
                <div class="settings-card" style="background: #F1FAFF; border-color: #009EF7;">
                    <div style="display: flex; align-items: start;">
                        <div style="font-size: 24px; margin-right: 15px;">‚ÑπÔ∏è</div>
                        <div>
                            <div style="font-weight: 600; color: #009EF7; margin-bottom: 6px;">Bilgi</div>
                            <div style="font-size: 13px; color: #5E6278; line-height: 1.6;">
                                Bu ayarlar canlƒ± sistemde √ßalƒ±≈üan intergram container'larƒ±nƒ± etkiler.
                                Deƒüi≈üiklikler kaydedildikten sonra container'lar otomatik olarak yeniden ba≈ülatƒ±lacaktƒ±r.
                                <br><br>
                                <strong>Servis Mesajlarƒ± Kapalƒ±yken:</strong> Sadece N8N AI yanƒ±tlarƒ± √ßalƒ±≈üƒ±r, Telegram'a otomatik bildirim gitmez.
                                <br>
                                <strong>Servis Mesajlarƒ± A√ßƒ±kken:</strong> T√ºm kullanƒ±cƒ± aktiviteleri ve mesajlarƒ± Telegram'a bildirilir.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Conversation Modal -->
    <div id="conversationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Konu≈üma Ge√ßmi≈üi: <span id="modalUserId"></span></h3>
                <button class="modal-close" onclick="closeConversationModal()">&times;</button>
            </div>
            <div class="modal-body" id="conversationContent">
                Y√ºkleniyor...
            </div>
        </div>
    </div>

    <script>
        // Check authentication
        (function() {
            const isAuth = localStorage.getItem('statsAuth');
            if (isAuth !== 'true') {
                window.location.replace('/login.html');
                return;
            }
        })();

        // Logout function
        function logout() {
            if (confirm('√áƒ±kƒ±≈ü yapmak istediƒüinize emin misiniz?')) {
                localStorage.removeItem('statsAuth');
                localStorage.removeItem('statsUser');
                localStorage.removeItem('statsLoginTime');
                window.location.replace('/login.html');
            }
        }

        // Sidebar toggle functionality
        let sidebarState = 'expanded'; // 'expanded', 'collapsed', 'mobile-open'

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            const hamburger = document.getElementById('hamburgerMenu');
            const isMobile = window.innerWidth <= 1024;

            if (isMobile) {
                // Mobile behavior: toggle open/close
                if (sidebar.classList.contains('mobile-open')) {
                    sidebar.classList.remove('mobile-open');
                    overlay.classList.remove('active');
                    hamburger.classList.remove('active');
                    document.body.style.overflow = ''; // Re-enable body scroll
                    sidebarState = 'expanded';
                } else {
                    sidebar.classList.add('mobile-open');
                    sidebar.classList.remove('collapsed');
                    overlay.classList.add('active');
                    hamburger.classList.add('active');
                    document.body.style.overflow = 'hidden'; // Prevent body scroll
                    sidebarState = 'mobile-open';
                }
            } else {
                // Desktop behavior: toggle collapsed/expanded
                if (sidebar.classList.contains('collapsed')) {
                    sidebar.classList.remove('collapsed');
                    hamburger.classList.remove('active');
                    sidebarState = 'expanded';
                } else {
                    sidebar.classList.add('collapsed');
                    hamburger.classList.add('active');
                    sidebarState = 'collapsed';
                }
            }

            // Save state
            localStorage.setItem('sidebarState', sidebarState);
        }

        // Initialize sidebar state on load
        window.addEventListener('DOMContentLoaded', function() {
            const savedState = localStorage.getItem('sidebarState');
            const sidebar = document.getElementById('sidebar');
            const hamburger = document.getElementById('hamburgerMenu');
            const isMobile = window.innerWidth <= 1024;

            if (isMobile) {
                // On mobile, always start collapsed (hidden)
                sidebar.classList.remove('mobile-open', 'collapsed');
            } else if (savedState === 'collapsed') {
                // On desktop, restore saved state
                sidebar.classList.add('collapsed');
                hamburger.classList.add('active');
            }
        });

        // Handle window resize
        window.addEventListener('resize', function() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            const hamburger = document.getElementById('hamburgerMenu');
            const isMobile = window.innerWidth <= 1024;

            if (!isMobile) {
                // Switched to desktop: remove mobile classes
                sidebar.classList.remove('mobile-open');
                overlay.classList.remove('active');

                // Restore saved state for desktop
                const savedState = localStorage.getItem('sidebarState');
                if (savedState === 'collapsed') {
                    sidebar.classList.add('collapsed');
                    hamburger.classList.add('active');
                } else {
                    sidebar.classList.remove('collapsed');
                    hamburger.classList.remove('active');
                }
            } else {
                // Switched to mobile: close sidebar
                sidebar.classList.remove('mobile-open', 'collapsed');
                overlay.classList.remove('active');
                hamburger.classList.remove('active');
            }
        });

        // Navigation
        const pageTitles = {
            'dashboard': 'Dashboard',
            'users': 'Web Users',
            'premium': 'Premium Chat',
            'userMessages': 'Kullanƒ±cƒ± Mesajlarƒ±',
            'settings': 'Settings'
        };

        function navigateToPage(page) {
            // Hide all pages
            document.querySelectorAll('.page-view').forEach(view => {
                view.classList.remove('active');
            });

            // Show selected page
            if (page === 'dashboard') {
                document.getElementById('dashboardView').classList.add('active');
            } else if (page === 'users') {
                document.getElementById('usersView').classList.add('active');
                loadAllUsers(); // Load users when page is shown
            } else if (page === 'premium') {
                document.getElementById('premiumView').classList.add('active');
                loadPremiumUsers(); // Load premium users when page is shown
            } else if (page === 'userMessages') {
                document.getElementById('userMessagesView').classList.add('active');
            } else if (page === 'settings') {
                document.getElementById('settingsView').classList.add('active');
                loadSettings(); // Load settings when page is shown
            }

            // Update menu active state
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.page === page) {
                    item.classList.add('active');
                }
            });

            // Update page title
            document.getElementById('pageTitle').textContent = pageTitles[page] || 'Dashboard';
        }

        // Menu click handlers
        document.querySelectorAll('.menu-item').forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                const page = this.dataset.page;
                if (page) {
                    navigateToPage(page);
                }
            });
        });

        // Show user messages
        function showUserMessages(userId) {
            navigateToPage('userMessages');
            loadUserMessages(userId);
        }

        // Load user messages
        async function loadUserMessages(userId) {
            const messagesContainer = document.getElementById('messagesContainer');
            const messagesTitle = document.getElementById('userMessagesTitle');
            const messagesSubtitle = document.getElementById('userMessagesSubtitle');

            messagesTitle.textContent = `Kullanƒ±cƒ±: ${userId}`;
            messagesSubtitle.textContent = 'Konu≈üma ge√ßmi≈üi y√ºkleniyor...';
            messagesContainer.innerHTML = '<div class="text-center" style="padding: 40px; color: #A1A5B7;">Mesajlar y√ºkleniyor...</div>';

            try {
                const response = await fetch(`https://n8n.photier.co/webhook/user-messages?userId=${userId}`);
                const messages = await response.json();

                if (messages.length === 0) {
                    messagesContainer.innerHTML = '<div class="text-center" style="padding: 40px; color: #A1A5B7;">Bu kullanƒ±cƒ±ya ait mesaj bulunamadƒ±.</div>';
                    messagesSubtitle.textContent = 'Mesaj bulunamadƒ±';
                    return;
                }

                messagesSubtitle.textContent = `${messages.length} mesaj`;

                messagesContainer.innerHTML = messages.map(msg => {
                    const isUser = msg.from === 'user';

                    const date = new Date(msg.createdAt);
                    const timeStr = date.toLocaleString('tr-TR', {
                        day: '2-digit',
                        month: '2-digit',
                        year: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });

                    // Determine background color and label
                    let bgColor, emoji, label, messageClass;
                    if (isUser) {
                        bgColor = '#F1FAFF';
                        emoji = 'üë§';
                        label = 'Kullanƒ±cƒ±';
                        messageClass = 'user';
                    } else if (msg.from === 'admin' && msg.human_mode === true) {
                        // Only admin messages with human_mode=true are Live Support
                        bgColor = '#e7dcf6';
                        emoji = 'üë§';
                        label = 'Live Support';
                        messageClass = 'live-support';
                    } else {
                        // All other non-user messages (bot, or admin without human_mode) are AI Bot
                        bgColor = '#E8FFF3';
                        emoji = 'ü§ñ';
                        label = 'AI Bot';
                        messageClass = 'bot';
                    }

                    return `
                        <div class="message-item ${messageClass}">
                            <div class="message-avatar" style="background: ${bgColor};">
                                ${emoji}
                            </div>
                            <div class="message-content">
                                <div class="message-header">
                                    <div class="message-author">${label}</div>
                                    <div class="message-time">${timeStr}</div>
                                </div>
                                <div class="message-text">${msg.message}</div>
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('Mesajlar y√ºklenirken hata:', error);
                messagesContainer.innerHTML = '<div class="text-center" style="padding: 40px; color: #F1416C;">Mesajlar y√ºklenirken bir hata olu≈ütu.</div>';
                messagesSubtitle.textContent = 'Hata olu≈ütu';
            }
        }

        // Premium Chat Functions - Now handled by api.js

        function showConversationModal(userId, messages, channel) {
            const modal = document.getElementById('conversationModal');
            const conversationContent = document.getElementById('conversationContent');
            const modalUserId = document.getElementById('modalUserId');

            // Track which conversation is open for real-time updates
            window.currentOpenUserId = userId;
            window.currentOpenChannel = channel;
            console.log('üéØ Modal opened - tracking userId:', window.currentOpenUserId, 'channel:', window.currentOpenChannel);

            modalUserId.textContent = userId;

            if (!messages || messages.length === 0) {
                conversationContent.innerHTML = '<div style="padding: 40px; text-align: center; color: #A1A5B7;">Hen√ºz mesaj yok</div>';
            } else {
                // Debug: Log first 3 messages
                if (messages.length > 0) {
                    console.log('üîç [Modal Debug] First 3 messages:', messages.slice(0, 3).map(m => ({
                        from: m.from,
                        human_mode: m.human_mode,
                        text: (m.message || m.text || '').substring(0, 20)
                    })));
                }

                conversationContent.innerHTML = messages.map(msg => {
                    const isUser = msg.from === 'visitor' || msg.from === 'user';

                    // Determine message class and label
                    let messageClass, messageLabel;
                    if (isUser) {
                        messageClass = 'visitor';
                        messageLabel = 'üë§ Kullanƒ±cƒ±';
                    } else if (msg.from === 'admin' && msg.human_mode === true) {
                        // Only admin messages with human_mode=true are Live Support
                        messageClass = 'live-support';
                        messageLabel = 'üéß Live Support';
                    } else {
                        // All other non-user messages (bot, or admin without human_mode) are AI Bot
                        messageClass = 'admin';
                        messageLabel = 'ü§ñ AI Bot';
                    }

                    // N8N sends: message, createdAt | Widget sends: text, time
                    const messageText = msg.message || msg.text || '';
                    const messageTime = msg.createdAt || msg.time || new Date();

                    // Format date in Turkish style: DD.MM.YYYY HH:MM:SS
                    const date = new Date(messageTime);
                    const formattedTime = date.toLocaleDateString('tr-TR', {
                        day: '2-digit',
                        month: '2-digit',
                        year: 'numeric'
                    }) + ' ' + date.toLocaleTimeString('tr-TR', {
                        hour: '2-digit',
                        minute: '2-digit',
                        second: '2-digit'
                    });

                    return `
                        <div class="conversation-message ${messageClass}">
                            <div class="conversation-message-content">
                                <div class="conversation-message-header">
                                    <span>${messageLabel}</span>
                                </div>
                                <div class="conversation-message-bubble">
                                    <div class="conversation-message-text">${escapeHtml(messageText)}</div>
                                    <div class="conversation-message-time">${formattedTime}</div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            modal.classList.add('active');

            // Auto-scroll to bottom after modal is visible
            setTimeout(() => {
                const modalBody = document.querySelector('.modal-body');
                if (modalBody) {
                    modalBody.scrollTop = modalBody.scrollHeight;
                }
            }, 100);
        }

        function closeConversationModal() {
            // Clear tracking variables
            window.currentOpenUserId = null;
            window.currentOpenChannel = null;
            document.getElementById('conversationModal').classList.remove('active');
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML.replace(/\n/g, '<br>');
        }

        function getTimeSince(dateString) {
            if (!dateString) return '-';

            const now = new Date();
            const past = new Date(dateString);
            const diffMs = now - past;
            const diffMins = Math.floor(diffMs / 60000);

            if (diffMins < 1) return '≈ûimdi';
            if (diffMins < 60) return `${diffMins} dk √∂nce`;

            const diffHours = Math.floor(diffMins / 60);
            if (diffHours < 24) return `${diffHours} saat √∂nce`;

            const diffDays = Math.floor(diffHours / 24);
            return `${diffDays} g√ºn √∂nce`;
        }

        // Close modal on outside click
        window.onclick = function(event) {
            const modal = document.getElementById('conversationModal');
            if (event.target === modal) {
                closeConversationModal();
            }
        }

        // ===== SETTINGS FUNCTIONS =====

        // Load current settings from containers
        async function loadSettings() {
            try {
                // Load web settings
                const webResponse = await fetch('https://chat.simplechat.bot/api/settings');
                const webData = await webResponse.json();
                document.getElementById('webServiceMessages').checked = webData.serviceMessagesEnabled || false;

                // Load web theme
                const webThemeResponse = await fetch('https://chat.simplechat.bot/api/theme');
                const webThemeData = await webThemeResponse.json();
                if (webThemeData.themeColor) {
                    document.getElementById('webThemeColor').value = webThemeData.themeColor;
                    document.getElementById('webThemeHex').value = webThemeData.themeColor.toUpperCase();
                }

                // Load premium settings
                const premiumResponse = await fetch('https://p-chat.simplechat.bot/api/settings');
                const premiumData = await premiumResponse.json();
                document.getElementById('premiumServiceMessages').checked = premiumData.serviceMessagesEnabled || false;

                // Load premium theme
                const premiumThemeResponse = await fetch('https://p-chat.simplechat.bot/api/theme');
                const premiumThemeData = await premiumThemeResponse.json();
                if (premiumThemeData.themeColor) {
                    document.getElementById('premiumThemeColor').value = premiumThemeData.themeColor;
                    document.getElementById('premiumThemeHex').value = premiumThemeData.themeColor.toUpperCase();
                }

                // Load web widget config
                const webWidgetResponse = await fetch('https://chat.simplechat.bot/api/widget-config');
                const webWidgetData = await webWidgetResponse.json();
                if (webWidgetData.success && webWidgetData.config) {
                    document.getElementById('webTitleClosed').value = webWidgetData.config.titleClosed || '';
                    document.getElementById('webTitleOpen').value = webWidgetData.config.titleOpen || '';
                    document.getElementById('webIntroMessage').value = webWidgetData.config.introMessage || '';
                    document.getElementById('webWorkingHoursEnabled').checked = webWidgetData.config.workingHoursEnabled || false;
                    document.getElementById('webWorkingHoursStart').value = webWidgetData.config.workingHoursStart || '09:00';
                    document.getElementById('webWorkingHoursEnd').value = webWidgetData.config.workingHoursEnd || '18:00';
                    toggleWebWorkingHours();
                }

                // Load premium widget config
                const premiumWidgetResponse = await fetch('https://p-chat.simplechat.bot/api/widget-config');
                const premiumWidgetData = await premiumWidgetResponse.json();
                if (premiumWidgetData.success && premiumWidgetData.config) {
                    document.getElementById('premiumTitleClosed').value = premiumWidgetData.config.titleClosed || '';
                    document.getElementById('premiumTitleOpen').value = premiumWidgetData.config.titleOpen || '';
                    document.getElementById('premiumIntroMessage').value = premiumWidgetData.config.introMessage || '';
                    document.getElementById('premiumAiIntroMessage').value = premiumWidgetData.config.aiIntroMessage || '';
                    document.getElementById('premiumWorkingHoursEnabled').checked = premiumWidgetData.config.workingHoursEnabled || false;
                    document.getElementById('premiumWorkingHoursStart').value = premiumWidgetData.config.workingHoursStart || '09:00';
                    document.getElementById('premiumWorkingHoursEnd').value = premiumWidgetData.config.workingHoursEnd || '18:00';
                    togglePremiumWorkingHours();
                }
            } catch (error) {
                console.error('Settings y√ºklenirken hata:', error);
                showSettingsStatus('Settings y√ºklenirken bir hata olu≈ütu', 'error');
            }
        }

        // Update web chat settings
        async function updateWebSettings() {
            const enabled = document.getElementById('webServiceMessages').checked;
            const toggle = document.getElementById('webServiceMessages');
            toggle.disabled = true;

            try {
                const response = await fetch('https://chat.simplechat.bot/api/settings', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ serviceMessagesEnabled: enabled })
                });

                const data = await response.json();

                if (data.success) {
                    showSettingsStatus(
                        `Web Chat ayarlarƒ± g√ºncellendi. Servis mesajlarƒ± ${enabled ? 'a√ßƒ±k' : 'kapalƒ±'}.`,
                        'success'
                    );
                } else {
                    throw new Error(data.error || 'Bilinmeyen hata');
                }
            } catch (error) {
                console.error('Web settings g√ºncellenirken hata:', error);
                showSettingsStatus('Web Chat ayarlarƒ± g√ºncellenirken bir hata olu≈ütu', 'error');
                // Revert toggle
                toggle.checked = !enabled;
            } finally {
                toggle.disabled = false;
            }
        }

        // Update premium chat settings
        async function updatePremiumSettings() {
            const enabled = document.getElementById('premiumServiceMessages').checked;
            const toggle = document.getElementById('premiumServiceMessages');
            toggle.disabled = true;

            try {
                const response = await fetch('https://p-chat.simplechat.bot/api/settings', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ serviceMessagesEnabled: enabled })
                });

                const data = await response.json();

                if (data.success) {
                    showSettingsStatus(
                        `Premium Chat ayarlarƒ± g√ºncellendi. Servis mesajlarƒ± ${enabled ? 'a√ßƒ±k' : 'kapalƒ±'}.`,
                        'success'
                    );
                } else {
                    throw new Error(data.error || 'Bilinmeyen hata');
                }
            } catch (error) {
                console.error('Premium settings g√ºncellenirken hata:', error);
                showSettingsStatus('Premium Chat ayarlarƒ± g√ºncellenirken bir hata olu≈ütu', 'error');
                // Revert toggle
                toggle.checked = !enabled;
            } finally {
                toggle.disabled = false;
            }
        }

        // Web color picker changed - update hex input
        function updateWebColorPreview() {
            const color = document.getElementById('webThemeColor').value;
            document.getElementById('webThemeHex').value = color.toUpperCase();
        }

        // Web hex input changed - update color picker
        function updateWebColorFromHex() {
            const hex = document.getElementById('webThemeHex').value;
            if (/^#[0-9A-F]{6}$/i.test(hex)) {
                document.getElementById('webThemeColor').value = hex;
            }
        }

        // Premium color picker changed - update hex input
        function updatePremiumColorPreview() {
            const color = document.getElementById('premiumThemeColor').value;
            document.getElementById('premiumThemeHex').value = color.toUpperCase();
        }

        // Premium hex input changed - update color picker
        function updatePremiumColorFromHex() {
            const hex = document.getElementById('premiumThemeHex').value;
            if (/^#[0-9A-F]{6}$/i.test(hex)) {
                document.getElementById('premiumThemeColor').value = hex;
            }
        }

        // Update web chat theme
        async function updateWebTheme() {
            const color = document.getElementById('webThemeHex').value;

            // Validate hex format
            if (!/^#[0-9A-F]{6}$/i.test(color)) {
                showSettingsStatus('Ge√ßersiz renk formatƒ±. #RRGGBB formatƒ±nda olmalƒ± (√∂rn: #009EF7)', 'error');
                return;
            }

            try {
                const response = await fetch('https://chat.simplechat.bot/api/theme', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ themeColor: color.toUpperCase() })
                });

                const data = await response.json();

                if (data.success) {
                    showSettingsStatus(
                        `Web Chat tema rengi g√ºncellendi: ${color.toUpperCase()}`,
                        'success'
                    );
                } else {
                    throw new Error(data.error || 'Bilinmeyen hata');
                }
            } catch (error) {
                console.error('Web theme g√ºncellenirken hata:', error);
                showSettingsStatus('Web Chat tema rengi g√ºncellenirken bir hata olu≈ütu', 'error');
            }
        }

        // Update premium chat theme
        async function updatePremiumTheme() {
            const color = document.getElementById('premiumThemeHex').value;

            // Validate hex format
            if (!/^#[0-9A-F]{6}$/i.test(color)) {
                showSettingsStatus('Ge√ßersiz renk formatƒ±. #RRGGBB formatƒ±nda olmalƒ± (√∂rn: #9F7AEA)', 'error');
                return;
            }

            try {
                const response = await fetch('https://p-chat.simplechat.bot/api/theme', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ themeColor: color.toUpperCase() })
                });

                const data = await response.json();

                if (data.success) {
                    showSettingsStatus(
                        `Premium Chat tema rengi g√ºncellendi: ${color.toUpperCase()}`,
                        'success'
                    );
                } else {
                    throw new Error(data.error || 'Bilinmeyen hata');
                }
            } catch (error) {
                console.error('Premium theme g√ºncellenirken hata:', error);
                showSettingsStatus('Premium Chat tema rengi g√ºncellenirken bir hata olu≈ütu', 'error');
            }
        }

        // Toggle working hours time inputs for Web
        function toggleWebWorkingHours() {
            const enabled = document.getElementById('webWorkingHoursEnabled').checked;
            const container = document.getElementById('webWorkingHoursTimeContainer');
            container.style.display = enabled ? 'flex' : 'none';
        }

        // Toggle working hours time inputs for Premium
        function togglePremiumWorkingHours() {
            const enabled = document.getElementById('premiumWorkingHoursEnabled').checked;
            const container = document.getElementById('premiumWorkingHoursTimeContainer');
            container.style.display = enabled ? 'flex' : 'none';
        }

        // Add event listeners for working hours toggles
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('webWorkingHoursEnabled').addEventListener('change', toggleWebWorkingHours);
            document.getElementById('premiumWorkingHoursEnabled').addEventListener('change', togglePremiumWorkingHours);
        });

        // Update web widget configuration
        async function updateWebWidgetConfig() {
            const config = {
                titleClosed: document.getElementById('webTitleClosed').value.trim(),
                titleOpen: document.getElementById('webTitleOpen').value.trim(),
                introMessage: document.getElementById('webIntroMessage').value.trim(),
                workingHoursEnabled: document.getElementById('webWorkingHoursEnabled').checked,
                workingHoursStart: document.getElementById('webWorkingHoursStart').value,
                workingHoursEnd: document.getElementById('webWorkingHoursEnd').value
            };

            try {
                const response = await fetch('https://chat.simplechat.bot/api/widget-config', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(config)
                });

                const data = await response.json();

                if (data.success) {
                    showSettingsStatus(
                        'Web Chat widget ayarlarƒ± ba≈üarƒ±yla g√ºncellendi!',
                        'success'
                    );
                } else {
                    throw new Error(data.error || 'Bilinmeyen hata');
                }
            } catch (error) {
                console.error('Web widget config g√ºncellenirken hata:', error);
                showSettingsStatus('Web Chat widget ayarlarƒ± g√ºncellenirken bir hata olu≈ütu: ' + error.message, 'error');
            }
        }

        // Update premium widget configuration
        async function updatePremiumWidgetConfig() {
            const config = {
                titleClosed: document.getElementById('premiumTitleClosed').value.trim(),
                titleOpen: document.getElementById('premiumTitleOpen').value.trim(),
                introMessage: document.getElementById('premiumIntroMessage').value.trim(),
                aiIntroMessage: document.getElementById('premiumAiIntroMessage').value.trim(),
                workingHoursEnabled: document.getElementById('premiumWorkingHoursEnabled').checked,
                workingHoursStart: document.getElementById('premiumWorkingHoursStart').value,
                workingHoursEnd: document.getElementById('premiumWorkingHoursEnd').value
            };

            try {
                const response = await fetch('https://p-chat.simplechat.bot/api/widget-config', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(config)
                });

                const data = await response.json();

                if (data.success) {
                    showSettingsStatus(
                        'Premium Chat widget ayarlarƒ± ba≈üarƒ±yla g√ºncellendi!',
                        'success'
                    );
                } else {
                    throw new Error(data.error || 'Bilinmeyen hata');
                }
            } catch (error) {
                console.error('Error updating premium widget config:', error);
                showSettingsStatus('Error updating Premium Chat widget settings: ' + error.message, 'error');
            }
        }

        // Save ALL Web Chat settings at once
        async function saveAllWebSettings() {
            const saveButton = event.target;
            saveButton.disabled = true;
            saveButton.textContent = 'Kaydediliyor...';

            try {
                // 1. Save theme color
                const themeColor = document.getElementById('webThemeHex').value;
                if (!/^#[0-9A-F]{6}$/i.test(themeColor)) {
                    throw new Error('Invalid color format');
                }

                // 2. Save widget config
                const widgetConfig = {
                    titleClosed: document.getElementById('webTitleClosed').value.trim(),
                    titleOpen: document.getElementById('webTitleOpen').value.trim(),
                    introMessage: document.getElementById('webIntroMessage').value.trim(),
                    workingHoursEnabled: document.getElementById('webWorkingHoursEnabled').checked,
                    workingHoursStart: document.getElementById('webWorkingHoursStart').value,
                    workingHoursEnd: document.getElementById('webWorkingHoursEnd').value
                };

                // 3. Save service messages setting
                const serviceMessagesEnabled = document.getElementById('webServiceMessages').checked;

                // Execute all saves in parallel
                const results = await Promise.all([
                    fetch('https://chat.simplechat.bot/api/theme', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ themeColor: themeColor.toUpperCase() })
                    }).then(r => r.json()),

                    fetch('https://chat.simplechat.bot/api/widget-config', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(widgetConfig)
                    }).then(r => r.json()),

                    fetch('https://chat.simplechat.bot/api/settings', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ serviceMessagesEnabled })
                    }).then(r => r.json())
                ]);

                // Check if all succeeded
                const allSuccess = results.every(r => r.success);

                if (allSuccess) {
                    showSettingsStatus('‚úÖ Web Chat settings saved successfully!', 'success');
                } else {
                    throw new Error('Some settings could not be saved');
                }
            } catch (error) {
                console.error('Web settings save error:', error);
                showSettingsStatus('‚ùå Hata: ' + error.message, 'error');
            } finally {
                saveButton.disabled = false;
                saveButton.textContent = 'Save All Settings';
            }
        }

        // Save ALL Premium Chat settings at once
        async function saveAllPremiumSettings() {
            const saveButton = event.target;
            saveButton.disabled = true;
            saveButton.textContent = 'Kaydediliyor...';

            try {
                // 1. Save theme color
                const themeColor = document.getElementById('premiumThemeHex').value;
                if (!/^#[0-9A-F]{6}$/i.test(themeColor)) {
                    throw new Error('Invalid color format');
                }

                // 2. Save widget config
                const widgetConfig = {
                    titleClosed: document.getElementById('premiumTitleClosed').value.trim(),
                    titleOpen: document.getElementById('premiumTitleOpen').value.trim(),
                    introMessage: document.getElementById('premiumIntroMessage').value.trim(),
                    aiIntroMessage: document.getElementById('premiumAiIntroMessage').value.trim(),
                    workingHoursEnabled: document.getElementById('premiumWorkingHoursEnabled').checked,
                    workingHoursStart: document.getElementById('premiumWorkingHoursStart').value,
                    workingHoursEnd: document.getElementById('premiumWorkingHoursEnd').value
                };

                // 3. Save service messages setting
                const serviceMessagesEnabled = document.getElementById('premiumServiceMessages').checked;

                // Execute all saves in parallel
                const results = await Promise.all([
                    fetch('https://p-chat.simplechat.bot/api/theme', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ themeColor: themeColor.toUpperCase() })
                    }).then(r => r.json()),

                    fetch('https://p-chat.simplechat.bot/api/widget-config', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(widgetConfig)
                    }).then(r => r.json()),

                    fetch('https://p-chat.simplechat.bot/api/settings', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ serviceMessagesEnabled })
                    }).then(r => r.json())
                ]);

                // Check if all succeeded
                const allSuccess = results.every(r => r.success);

                if (allSuccess) {
                    showSettingsStatus('‚úÖ Premium Chat settings saved successfully!', 'success');
                } else {
                    throw new Error('Some settings could not be saved');
                }
            } catch (error) {
                console.error('Premium settings save error:', error);
                showSettingsStatus('‚ùå Hata: ' + error.message, 'error');
            } finally {
                saveButton.disabled = false;
                saveButton.textContent = 'Save All Settings';
            }
        }

        // Show status message
        function showSettingsStatus(message, type) {
            const statusEl = document.getElementById('settingsStatusMessage');
            statusEl.textContent = message;
            statusEl.className = 'settings-status ' + type;

            // Auto-hide after 5 seconds
            setTimeout(() => {
                statusEl.className = 'settings-status';
            }, 5000);
        }

        // Widget Theme Selection Variables
        let selectedWebTheme = 'bubble-chat';
        let selectedPremiumTheme = 'bubble-chat';

        // Select Web Theme (simplified for dropdown)
        function selectWebTheme(themeId) {
            selectedWebTheme = themeId;
            const selectElement = document.getElementById('webThemeSelect');
            if (selectElement) {
                selectElement.value = themeId;
            }
            console.log('Selected web theme:', themeId);
        }

        // Select Premium Theme (simplified for dropdown)
        function selectPremiumTheme(themeId) {
            selectedPremiumTheme = themeId;
            const selectElement = document.getElementById('premiumThemeSelect');
            if (selectElement) {
                selectElement.value = themeId;
            }
            console.log('Selected premium theme:', themeId);
        }

        // Load saved themes on page load
        function loadSavedThemes() {
            try {
                const savedThemes = localStorage.getItem('widgetThemes');
                if (savedThemes) {
                    const themes = JSON.parse(savedThemes);
                    if (themes.webTheme) {
                        selectedWebTheme = themes.webTheme;
                        selectWebTheme(themes.webTheme);
                    }
                    if (themes.premiumTheme) {
                        selectedPremiumTheme = themes.premiumTheme;
                        selectPremiumTheme(themes.premiumTheme);
                    }
                    console.log('Loaded saved themes:', themes);
                }
            } catch (error) {
                console.error('Error loading saved themes:', error);
            }
        }

    </script>
    <script src="/api.js?v="></script>

    <!-- Socket.IO Client for Real-time Updates -->
    <!-- Socket.IO Client v4.8.1 (latest stable version) -->
    <script src="https://cdn.socket.io/4.8.1/socket.io.min.js" crossorigin="anonymous"></script>
    <script>
        // Real-time WebSocket connection
        // Note: webSocket and premiumSocket are already defined in api.js
        // let webSocket = null;  // REMOVED - Duplicate declaration (already in api.js)
        // let premiumSocket = null;  // REMOVED - Duplicate declaration (already in api.js)
        let reconnectAttempts = 0;
        const MAX_RECONNECT_ATTEMPTS = 5;

        // Track which user's conversation is currently open
        // Global variables for tracking open conversation (shared with api.js)
        window.currentOpenUserId = null;
        window.currentOpenChannel = null;

        // Debounce timer for stats updates (prevent flickering)
        let statsUpdateTimer = null;

        function connectWebSocket() {
            try {
                // Determine URL based on environment
                const isLocal = window.location.hostname === 'localhost';
                const webSocketUrl = isLocal ? 'http://localhost:3000/stats' : 'https://chat.simplechat.bot/stats';

                console.log('üîå Connecting to Web Chat WebSocket...');
                console.log('üåç Environment:', isLocal ? 'LOCAL' : 'PRODUCTION');
                console.log('üîó URL:', webSocketUrl);

                webSocket = io(webSocketUrl, {
                    transports: ['websocket', 'polling'],
                    reconnection: true,
                    reconnectionDelay: 1000,
                    reconnectionAttempts: MAX_RECONNECT_ATTEMPTS
                });

                webSocket.on('connect', function() {
                    console.log('‚úÖ Web Chat WebSocket connected!');
                    reconnectAttempts = 0;
                    updateConnectionStatus('web', true);
                });

                webSocket.on('stats_update', function(data) {
                    console.log('üìä Web Stats Update:', data);
                    handleStatsUpdate(data, data.channel);
                });

                webSocket.on('disconnect', function() {
                    console.log('‚ùå Web Chat WebSocket disconnected');
                    updateConnectionStatus('web', false);
                    // Auto-reconnect after 3 seconds
                    setTimeout(function() {
                        if (!webSocket.connected) {
                            console.log('üîÑ Attempting to reconnect Web Chat WebSocket...');
                            connectWebSocket();
                        }
                    }, 3000);
                });

                webSocket.on('connect_error', function(error) {
                    console.error('‚ùå Web Chat connection error:', error);
                    reconnectAttempts++;
                    if (reconnectAttempts >= MAX_RECONNECT_ATTEMPTS) {
                        console.log('Max reconnection attempts reached for Web Chat');
                    }
                });
            } catch (error) {
                console.error('Failed to connect to Web Chat WebSocket:', error);
            }
        }

        function connectPremiumWebSocket() {
            try {
                // Determine URL based on environment
                const isLocal = window.location.hostname === 'localhost';
                const premiumSocketUrl = isLocal ? 'http://localhost:3001/stats' : 'https://p-chat.simplechat.bot/stats';

                console.log('üîå Connecting to Premium Chat WebSocket...');
                console.log('üåç Environment:', isLocal ? 'LOCAL' : 'PRODUCTION');
                console.log('üîó URL:', premiumSocketUrl);

                premiumSocket = io(premiumSocketUrl, {
                    transports: ['websocket', 'polling'],
                    reconnection: true,
                    reconnectionDelay: 1000,
                    reconnectionAttempts: MAX_RECONNECT_ATTEMPTS
                });

premiumSocket.on('connect', function() {                    console.log('‚úÖ Premium Chat WebSocket connected!');                    console.log('üîç Premium Socket ID:', premiumSocket.id);                    console.log('üîç Premium Socket connected:', premiumSocket.connected);                    updateConnectionStatus('premium', true);                });                premiumSocket.on('stats_update', function(data) {                    console.log('üìä Premium Stats Update RECEIVED:', JSON.stringify(data));                    console.log('üìä Data type:', data.type, 'Channel:', data.channel);                    handleStatsUpdate(data, data.channel);                });                premiumSocket.on('disconnect', function() {                    console.log('‚ùå Premium Chat WebSocket disconnected');                    console.log('üîç Premium Socket ID:', premiumSocket.id);                    updateConnectionStatus('premium', false);                });                premiumSocket.on('connect_error', function(error) {                    console.error('‚ùå Premium connection error:', error);                });                // Add wildcard listener to see ALL events                premiumSocket.onAny(function(eventName, ...args) {                    console.log('üéØ Premium Socket received event:', eventName, 'Args:', args);                });
            } catch (error) {
                console.error('Failed to connect to Premium WebSocket:', error);
            }
        }

        function updateConnectionStatus(channel, connected) {
            // Visual indicator could be added here
            const indicator = document.getElementById(`${channel}ConnectionIndicator`);
            if (indicator) {
                indicator.style.background = connected ? '#50CD89' : '#F1416C';
            }
        }


        // Connect on page load
        // DISABLED: WebSocket connections now handled by api.js with Phase 1 features
        // document.addEventListener('DOMContentLoaded', function() {
        //     console.log('üöÄ Initializing Real-time WebSocket connections...');
        //     connectWebSocket();
        //     connectPremiumWebSocket();
        // });
    
        // Translations
        window.translations = {
            "Intergram AI Chat - Admin Panel": {"tr": "Intergram AI Chat - Y√∂netim Paneli", "en": "Intergram AI Chat - Admin Panel"},
            "Anasayfa": {"tr": "Anasayfa", "en": "Home"},
            "Dashboard": {"tr": "Ana Sayfa", "en": "Dashboard"},
            "Web Kullanƒ±cƒ±lar": {"tr": "Web Kullanƒ±cƒ±lar", "en": "Web Users"},
            "Settings": {"tr": "Ayarlar", "en": "Settings"},
            "√áƒ±kƒ±≈ü Yap": {"tr": "√áƒ±kƒ±≈ü Yap", "en": "Logout"},
            "Son g√ºncelleme": {"tr": "Son g√ºncelleme", "en": "Last update"},
            "AI ile Hizmet": {"tr": "AI ile Hizmet", "en": "AI Service"},
            "Destek Ekibi": {"tr": "Destek Ekibi", "en": "Support Team"},
            "online": {"tr": "online", "en": "online"},
            "Ort. yanƒ±t": {"tr": "Ort. yanƒ±t", "en": "Avg. response"},
            "Mesajlar": {"tr": "Mesajlar", "en": "Messages"},
            "Web Chat": {"tr": "Web Sohbet", "en": "Web Chat"},
            "Premium Users": {"tr": "Premium Kullanƒ±cƒ±lar", "en": "Premium Users"},
            "Ayarlar": {"tr": "Ayarlar", "en": "Settings"},
            "Toplam Session": {"tr": "Toplam Session", "en": "Total Sessions"},
            "Online Now": {"tr": "√áevrimi√ßi", "en": "Online now"},
            "active users": {"tr": "aktif kullanƒ±cƒ±", "en": "active users"},
            "Total Users": {"tr": "TOPLAM KULLANICI", "en": "TOTAL USERS"},
            "unique visitors": {"tr": "benzersiz ziyaret√ßi", "en": "unique visitors"},
            "Active Today": {"tr": "BUG√úN AKTƒ∞F", "en": "ACTIVE TODAY"},
            "users today": {"tr": "bug√ºnk√º kullanƒ±cƒ±", "en": "users today"},
            "Bug√ºn Yeni": {"tr": "Bug√ºn Yeni", "en": "New Today"},
            "Aktif Kullanƒ±cƒ±": {"tr": "Aktif Kullanƒ±cƒ±", "en": "Active Users"},
            "√áevrimi√ßi": {"tr": "√áevrimi√ßi", "en": "Online"},
            "Toplam Mesaj": {"tr": "Toplam Mesaj", "en": "Total Messages"},
            "Bug√ºn G√∂nderilen": {"tr": "Bug√ºn G√∂nderilen", "en": "Sent Today"},
            "Ortalama S√ºre": {"tr": "Ortalama S√ºre", "en": "Avg. Duration"},
            "ORTALAMA S√úRE": {"tr": "ORTALAMA S√úRE", "en": "AVERAGE DURATION"},
            "Oturum S√ºresi": {"tr": "Oturum S√ºresi", "en": "Session Duration"},
            "En Kƒ±sa": {"tr": "En Kƒ±sa", "en": "Shortest"},
            "ORT. MESAJ": {"tr": "ORT. MESAJ", "en": "AVG. MESSAGES"},
            "Mesaj / Session": {"tr": "Mesaj / Session", "en": "Messages / Session"},
            "KANAL DAƒûILIMI": {"tr": "KANAL DAƒûILIMI", "en": "CHANNEL DISTRIBUTION"},
            "AI / Human": {"tr": "AI / Human", "en": "AI / Human"},
            "AI ile Hizmet": {"tr": "AI ile Hizmet", "en": "AI Service"},
            "Destek Ekibi": {"tr": "Destek Ekibi", "en": "Support Team"},
            "TRAFƒ∞K ANALƒ∞Zƒ∞": {"tr": "TRAFƒ∞K ANALƒ∞Zƒ∞", "en": "TRAFFIC ANALYSIS"},
            "En Yoƒüun Saatler Haritasƒ±": {"tr": "En Yoƒüun Saatler Haritasƒ±", "en": "Busiest Hours Heatmap"},
            "Hangi g√ºn ve saatlerde en √ßok mesaj alƒ±nƒ±yor?": {"tr": "Hangi g√ºn ve saatlerde en √ßok mesaj alƒ±nƒ±yor? (Web + Premium)", "en": "Which days and hours receive the most messages? (Web + Premium)"},
            "AI PERFORMANS": {"tr": "AI PERFORMANS", "en": "AI PERFORMANCE"},
            "AI Ba≈üarƒ± Oranƒ±": {"tr": "AI Ba≈üarƒ± Oranƒ±", "en": "AI Success Rate"},
            "AI desteƒüi olmadan √ß√∂z√ºlen konu≈üma y√ºzdesi": {"tr": "ƒ∞nsan desteƒüine ihtiya√ß duymadan AI tarafƒ±ndan ba≈üarƒ±yla √ß√∂z√ºlen konu≈ümalarƒ±n y√ºzdesi. Y√ºksek oran, AI'ƒ±n kullanƒ±cƒ± sorularƒ±nƒ± etkili bir ≈üekilde yanƒ±tladƒ±ƒüƒ±nƒ± g√∂sterir.", "en": "Percentage of conversations successfully resolved by AI without human support. A high rate indicates AI effectively answers user questions."},
            "AI Ba≈üarƒ±": {"tr": "AI Ba≈üarƒ±", "en": "AI Success"},
            "dakika": {"tr": "dakika", "en": "minutes"},
            "Kullanƒ±cƒ±": {"tr": "Kullanƒ±cƒ±", "en": "User"},
            "Son Mesaj": {"tr": "Son Mesaj", "en": "Last Message"},
            "Kaynak": {"tr": "Kaynak", "en": "Source"},
            "Durum": {"tr": "Durum", "en": "Status"},
            "√úlke": {"tr": "√úlke", "en": "Country"},
            "ƒ∞≈ülemler": {"tr": "ƒ∞≈ülemler", "en": "Actions"},
            "Mesaj Sayƒ±sƒ±": {"tr": "Mesaj Sayƒ±sƒ±", "en": "Message Count"},
            "ƒ∞lk Aktivite": {"tr": "ƒ∞lk Aktivite", "en": "First Activity"},
            "Son Aktivite": {"tr": "Son Aktivite", "en": "Last Activity"},
            "Aktif": {"tr": "Aktif", "en": "Active"},
            "√áevrimdƒ±≈üƒ±": {"tr": "√áevrimdƒ±≈üƒ±", "en": "Offline"},
            "AI Bot": {"tr": "AI Bot", "en": "AI Bot"},
            "Canlƒ± Destek": {"tr": "Canlƒ± Destek", "en": "Live Support"},
            "Web Chat Ayarlarƒ±": {"tr": "Web Chat Ayarlarƒ±", "en": "Web Chat Settings"},
            "Premium Chat Ayarlarƒ±": {"tr": "Premium Chat Ayarlarƒ±", "en": "Premium Chat Settings"},
            "Tema Rengi": {"tr": "Tema Rengi", "en": "Theme Color"},
            "Chat Ba≈ülƒ±ƒüƒ± (Kapalƒ±)": {"tr": "Chat Ba≈ülƒ±ƒüƒ± (Kapalƒ±)", "en": "Chat Title (Closed)"},
            "Chat Ba≈ülƒ±ƒüƒ± (A√ßƒ±k)": {"tr": "Chat Ba≈ülƒ±ƒüƒ± (A√ßƒ±k)", "en": "Chat Title (Open)"},
            "Kar≈üƒ±lama Mesajƒ±": {"tr": "Kar≈üƒ±lama Mesajƒ±", "en": "Intro Message"},
            "AI Bot Kar≈üƒ±lama Mesajƒ±": {"tr": "AI Bot Kar≈üƒ±lama Mesajƒ±", "en": "AI Bot Intro Message"},
            "√áalƒ±≈üma Saatleri": {"tr": "√áalƒ±≈üma Saatleri", "en": "Working Hours"},
            "Servis Mesajlarƒ±": {"tr": "Servis Mesajlarƒ±", "en": "Service Messages"},
            "T√ºm Ayarlarƒ± Kaydet": {"tr": "T√ºm Ayarlarƒ± Kaydet", "en": "Save All Settings"},
            "Kaydediliyor...": {"tr": "Kaydediliyor...", "en": "Saving..."},
            "Widget kapalƒ±yken g√∂sterilen ba≈ülƒ±k metni": {"tr": "Widget kapalƒ±yken g√∂sterilen ba≈ülƒ±k metni", "en": "Title text shown when widget is closed"},
            "Widget a√ßƒ±kken g√∂sterilen ba≈ülƒ±k metni": {"tr": "Widget a√ßƒ±kken g√∂sterilen ba≈ülƒ±k metni", "en": "Title text shown when widget is open"},
            "Chat a√ßƒ±ldƒ±ƒüƒ±nda kullanƒ±cƒ±ya g√∂sterilen ilk mesaj": {"tr": "Chat a√ßƒ±ldƒ±ƒüƒ±nda kullanƒ±cƒ±ya g√∂sterilen ilk mesaj", "en": "First message shown to user when chat opens"},
            "G√∂r√ºnt√ºle": {"tr": "G√∂r√ºnt√ºle", "en": "View"},
            "Sil": {"tr": "Sil", "en": "Delete"},
            "Kapat": {"tr": "Kapat", "en": "Close"},
            "√ñnceki": {"tr": "√ñnceki", "en": "Previous"},
            "Sonraki": {"tr": "Sonraki", "en": "Next"},
            "Total Impressions": {"tr": "Toplam Tƒ±klama", "en": "Total Impressions"},
            "all openers": {"tr": "t√ºm a√ßanlar", "en": "all openers"},
            "Conversion Rate": {"tr": "Konversiyon Oranƒ±", "en": "Conversion Rate"},
            "openers / talkers": {"tr": "a√ßan / konu≈üan", "en": "openers / talkers"},
            "Toplam Kullanƒ±cƒ±": {"tr": "Toplam Kullanƒ±cƒ±", "en": "Total Users"},
            "Bug√ºn Aktif": {"tr": "Bug√ºn Aktif", "en": "Active Today"},
            "benzersiz ziyaret√ßi": {"tr": "benzersiz ziyaret√ßi", "en": "unique visitors"},
            "bug√ºnk√º kullanƒ±cƒ±": {"tr": "bug√ºnk√º kullanƒ±cƒ±", "en": "today's users"},
            "Total Messages": {"tr": "Toplam Mesaj", "en": "Total Messages"},
            "Longest": {"tr": "En Uzun", "en": "Longest"},
            "Total Sessions": {"tr": "Toplam Session", "en": "Total Sessions"},
            "TOTAL CONVERSATIONS": {"tr": "TOPLAM KONU≈ûMA", "en": "TOTAL CONVERSATIONS"},
            "Daily User Count": {"tr": "G√ºnl√ºk Kullanƒ±cƒ± Sayƒ±sƒ±", "en": "Daily User Count"},
            "AI vs Human Support": {"tr": "AI vs ƒ∞nsan Desteƒüi", "en": "AI vs Human Support"},
            "Message Distribution (Monthly)": {"tr": "Mesaj Daƒüƒ±lƒ±mƒ± (Aylƒ±k)", "en": "Message Distribution (Monthly)"},
            "Country Distribution": {"tr": "√úlke Daƒüƒ±lƒ±mƒ±", "en": "Country Distribution"},
            "Web Users": {"tr": "Web Kullanƒ±cƒ±lar", "en": "Web Users"},
            "Premium Users": {"tr": "Premium Kullanƒ±cƒ±lar", "en": "Premium Users"},
            "Back to Web Users": {"tr": "Web Kullanƒ±cƒ±lara D√∂n", "en": "Back to Web Users"},
            "Web Chat Settings": {"tr": "Web Chat Ayarlarƒ±", "en": "Web Chat Settings"},
            "Premium Chat Settings": {"tr": "Premium Chat Ayarlarƒ±", "en": "Premium Chat Settings"},
            "Primary color for chat widget": {"tr": "Chat widget'ƒ±nƒ±n ana rengi", "en": "Primary color for chat widget"},
            "can be left empty": {"tr": "bo≈ü bƒ±rakƒ±labilir", "en": "can be left empty"},
            "Working Hours (Turkey Time)": {"tr": "√áalƒ±≈üma Saatleri (T√ºrkiye Saati)", "en": "Working Hours (Turkey Time)"},
            "Set start and end times": {"tr": "Ba≈ülangƒ±√ß ve biti≈ü saatlerini belirleyin", "en": "Set start and end times"},
            "Automatically hide widget outside working hours": {"tr": "√áalƒ±≈üma saatleri dƒ±≈üƒ±nda widget'ƒ± otomatik olarak gizle", "en": "Automatically hide widget outside working hours"},
            "First message shown to user in AI Bot tab": {"tr": "AI Bot tab'ƒ±nda kullanƒ±cƒ±ya g√∂sterilen ilk mesaj", "en": "First message shown to user in AI Bot tab"},
            "User connection notifications": {"tr": "Kullanƒ±cƒ± baƒülantƒ± bildirimleri", "en": "User connection notifications"},
            "Support Type": {"tr": "Destek Tipi", "en": "Support Type"},
            "User ID": {"tr": "Kullanƒ±cƒ± ID", "en": "User ID"},
            "Name": {"tr": "ƒ∞sim", "en": "Name"},
            "Message Count": {"tr": "Mesaj Sayƒ±sƒ±", "en": "Message Count"},
            "Last Activity": {"tr": "Son Aktivite", "en": "Last Activity"},
            "Country": {"tr": "√úlke", "en": "Country"},
            "Status": {"tr": "Durum", "en": "Status"},
            "Search user...": {"tr": "Kullanƒ±cƒ± ara...", "en": "Search user..."},
            "Arama...": {"tr": "Arama...", "en": "Search..."},
            "AI vs ƒ∞nsan": {"tr": "AI vs ƒ∞nsan", "en": "AI vs Human"},
            "Mesaj Kaynaƒüƒ± Daƒüƒ±lƒ±mƒ±": {"tr": "Mesaj Kaynaƒüƒ± Daƒüƒ±lƒ±mƒ±", "en": "Message Source Distribution"},
            "En Yoƒüun Saatler": {"tr": "En Yoƒüun Saatler", "en": "Busiest Hours"},
            "Saat": {"tr": "Saat", "en": "Hour"},
            "Mesaj": {"tr": "Mesaj", "en": "Messages"},
            "Widget Temasƒ±": {"tr": "Widget Temasƒ±", "en": "Widget Theme"},
            "Pazar": {"tr": "Pazar", "en": "Sunday"},
            "Pazartesi": {"tr": "Pazartesi", "en": "Monday"},
            "Salƒ±": {"tr": "Salƒ±", "en": "Tuesday"},
            "√áar≈üamba": {"tr": "√áar≈üamba", "en": "Wednesday"},
            "Per≈üembe": {"tr": "Per≈üembe", "en": "Thursday"},
            "Cuma": {"tr": "Cuma", "en": "Friday"},
            "Cumartesi": {"tr": "Cumartesi", "en": "Saturday"},
            "Widget tasarƒ±mƒ±nƒ± se√ßin": {"tr": "Widget tasarƒ±mƒ±nƒ± se√ßin", "en": "Select widget design"},
            "Bubble Chat": {"tr": "Bubble Chat", "en": "Bubble Chat"},
            "Yakƒ±nda...": {"tr": "Yakƒ±nda...", "en": "Coming soon..."}
        };

        // Get saved language or default to TR
        let currentLanguage = localStorage.getItem('language') || 'tr';

        // Toggle language menu
        window.toggleLangMenu = function(event) {
            event.stopPropagation();
            document.getElementById('langDropdown').classList.toggle('active');
        }

        // Close language menu when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.lang-dropdown')) {
                document.getElementById('langDropdown').classList.remove('active');
            }
        });

        // Change language
        window.changeLang = function(lang) {
            currentLanguage = lang;
            localStorage.setItem('language', lang);
            
            // Update flag and text
            const flags = { tr: 'üáπüá∑', en: 'üá¨üáß' };
            document.getElementById('currentFlag').textContent = flags[lang];
            document.getElementById('currentLang').textContent = lang.toUpperCase();
            
            // Update active state
            document.querySelectorAll('.lang-option').forEach(opt => {
                opt.classList.toggle('active', opt.dataset.lang === lang);
            });
            
            // Translate page
            window.translatePage(lang);
            
            // Close menu
            document.getElementById('langDropdown').classList.remove('active');
        }

        // Translate page function
        window.translatePage = function(lang) {
            // Translate all elements with data-i18n attribute
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.dataset.i18n;
                if (window.translations[key] && window.translations[key][lang]) {
                    if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
                        el.placeholder = window.translations[key][lang];
                    } else {
                        el.textContent = window.translations[key][lang];
                    }
                }
            });
            
            // Refresh heatmap with saved stats data (no page reload needed)
            if (typeof updateHeatmap === 'function' && window.lastWebStats) {
                updateHeatmap(window.lastWebStats, window.lastPremiumStats);
            }
        }

        // Initialize language on page load
        document.addEventListener('DOMContentLoaded', function() {
            const savedLang = localStorage.getItem('language') || 'tr';
            window.changeLang(savedLang);

            // Load saved widget themes
            loadSavedThemes();
        });

    </script>
<script>
// Fix language dropdown and options with addEventListener
setTimeout(function() {
    console.log('[Lang] Initializing language switcher...');

    // Button handler
    const langBtn = document.querySelector(".lang-btn");
    if (langBtn) {
        console.log('[Lang] Button found, adding click handler');
        langBtn.addEventListener("click", function(e) {
            console.log('[Lang] Button clicked!');
            e.preventDefault();
            e.stopPropagation();
            const dropdown = document.getElementById("langDropdown");
            if (dropdown) {
                dropdown.classList.toggle("active");
                console.log('[Lang] Dropdown toggled, active:', dropdown.classList.contains('active'));
            }
        });
    } else {
        console.error('[Lang] Button NOT found!');
    }

    // Language option handlers
    const langOptions = document.querySelectorAll(".lang-option");
    console.log('[Lang] Found', langOptions.length, 'language options');

    langOptions.forEach(function(option, index) {
        const lang = option.getAttribute("data-lang");
        console.log('[Lang] Adding handler for option', index, '- language:', lang);

        option.addEventListener("click", function(e) {
            console.log('[Lang] Option clicked! Language:', lang);
            e.preventDefault();
            e.stopPropagation();

            if (window.changeLang) {
                console.log('[Lang] Calling window.changeLang with:', lang);
                window.changeLang(lang);
            } else {
                console.error('[Lang] window.changeLang NOT FOUND!');
            }
        });
    });

    console.log('[Lang] Initialization complete');
}, 500);
</script>
</body>
</html>
